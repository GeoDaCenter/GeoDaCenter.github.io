<!DOCTYPE html>

<html>

<head>

  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="author" content="Luc Anselin" />


  <title>Spatial Data Wrangling (2) – GIS Operations</title>

  <script src="lab1b_files/header-attrs-2.3/header-attrs.js"></script>
  <link href="lab1b_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
  <script src="lab1b_files/highlightjs-9.12.0/highlight.js"></script>
  <title>GeoDa on Github</title>

  <style>
    * {
      margin: 0;
      padding: 0;
    }

    .shadowfilter {
      -webkit-filter: drop-shadow(12px 12px 7px rgba(0, 0, 0, 0.5));
      filter: url(shadow.svg#drop-shadow);
    }

    .intro1 {
      margin-left: -45px;
    }
  </style>
  <link rel="stylesheet" type="text/css" href="https://geodacenter.github.io/stylesheets/normalize.css" media="screen">
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="https://geodacenter.github.io/stylesheets/stylesheet.css" media="screen">
  <link rel="stylesheet" type="text/css" href="https://geodacenter.github.io/stylesheets/github-light.css"
    media="screen">
  <link rel="stylesheet" href="https://geodacenter.github.io/stylesheets/simple-slideshow-styles.css">
  <style>
    ul {
      padding-left: 30px;
    }

    figcaption {
      top: .70em;
      left: .35em;
      bottom: auto !important;
      right: auto !important;
    }
  </style>

  <style>
    h1 {
      text-align: center;
    }

    h3.subtitle {
      text-align: center;
    }

    h4.author {
      text-align: center;
    }

    h4.date {
      text-align: center;
    }

    p.caption {
      font-size: 12px;
    }
  </style>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LC0QJ53WFS"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-LC0QJ53WFS');
  </script>
  <!-- End Google tag -->

  <style type="text/css">
    code {
      white-space: pre;
    }
  </style>
  <script type="text/javascript">
    if (window.hljs) {
      hljs.configure({ languages: [] });
      hljs.initHighlightingOnLoad();
      if (document.readyState && document.readyState === "complete") {
        window.setTimeout(function () { hljs.initHighlighting(); }, 0);
      }
    }
  </script>








</head>

<body>


  <section class="page-header">
    <h1 class="project-name">GeoDa</h1>
    <h2 class="project-tagline">An Introduction to Spatial Data Science</h2>
    <a href="https://geodacenter.github.io/index.html" class="btn">Homepage</a>
    <a href="https://geodacenter.github.io/download.html" class="btn">Download</a>
    <a href="https://github.com/GeoDaCenter/geoda/" class="btn">View on GitHub</a>
    <a href="https://spatial.uchicago.edu/sample-data" target="_blank" class="btn">Data</a>
    <a href="https://geodacenter.github.io/documentation.html" class="btn">Documentation</a>
    <a href="https://geodacenter.github.io/support.html" class="btn">Support</a>
    <a href="https://geodacenter.github.io/index-cn.html" class="btn">中文</a>
  </section>

  <section class="main-content">


    <h1 class="title toc-ignore">Spatial Data Wrangling (2) – GIS Operations</h1>
    <h4 class="author">Luc Anselin<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></h4>
    <h4 class="date">09/16/2020 (updated)</h4>


    <div id="TOC">
      <ul>
        <li><a href="#introduction">Introduction</a>
          <ul>
            <li><a href="#objectives">Objectives</a>
              <ul>
                <li><a href="#geoda-functions-covered">GeoDa functions covered</a></li>
              </ul>
            </li>
            <li><a href="#preliminaries">Preliminaries</a></li>
          </ul>
        </li>
        <li><a href="#projections">Projections</a>
          <ul>
            <li><a href="#coordinate-reference-system-crs">Coordinate reference system (CRS)</a></li>
            <li><a href="#selecting-a-projection">Selecting a projection</a></li>
            <li><a href="#reprojection">Reprojection</a></li>
          </ul>
        </li>
        <li><a href="#converting-between-points-and-polygons">Converting Between Points and Polygons</a>
          <ul>
            <li><a href="#mean-centers-and-centroids">Mean centers and centroids</a></li>
            <li><a href="#thiessen-polygons">Thiessen polygons</a></li>
          </ul>
        </li>
        <li><a href="#minimum-spanning-tree-mst">Minimum Spanning Tree (MST)</a></li>
        <li><a href="#aggregation">Aggregation</a>
          <ul>
            <li><a href="#dissolve">Dissolve</a></li>
            <li><a href="#aggregation-in-table">Aggregation in table</a></li>
          </ul>
        </li>
        <li><a href="#multi-layer-support">Multi-Layer Support</a>
          <ul>
            <li><a href="#loading-multiple-layers">Loading multiple layers</a></li>
            <li><a href="#automatic-reprojection">Automatic reprojection</a></li>
            <li><a href="#layer-position">Layer position</a></li>
            <li><a href="#selection">Selection</a></li>
          </ul>
        </li>
        <li><a href="#spatial-join">Spatial Join</a>
          <ul>
            <li><a href="#spatial-assign">Spatial assign</a></li>
            <li><a href="#spatial-count">Spatial count</a></li>
          </ul>
        </li>
        <li><a href="#linked-multi-layers">Linked Multi-Layers</a>
          <ul>
            <li><a href="#from-point-to-area">From point to area</a></li>
            <li><a href="#from-area-to-point">From area to point</a></li>
          </ul>
        </li>
        <li><a href="#appendix">Appendix</a>
          <ul>
            <li><a href="#prims-minimum-spanning-tree-algorithm">Prim’s Minimum Spanning Tree algorithm</a></li>
          </ul>
        </li>
        <li><a href="#references">References</a></li>
      </ul>
    </div>

    <p><br></p>
    <div id="introduction" class="section level2 unnumbered" number="">
      <h2>Introduction</h2>
      <p>Even though <code>GeoDa</code> is <em>not</em> a GIS by design, a range of spatial data manipulation functions
        are available
        that perform some specialized GIS operations. This includes an efficient treatment of projections, conversion
        between points and polygons, the computation of a minimum spanning tree, and spatial aggregation and spatial
        join
        through multi-layer support.</p>
      <div id="objectives" class="section level3 unnumbered" number="">
        <h3>Objectives</h3>
        <ul>
          <li>
            <p>Understand how projections are expressed in a coordinate reference system (CRS)</p>
          </li>
          <li>
            <p>Be able to efficiently change from one projection to another</p>
          </li>
          <li>
            <p>Create shape centers (mean center and centroid) for polygons</p>
          </li>
          <li>
            <p>Construct Thiessen polygons for a point layer</p>
          </li>
          <li>
            <p>Compute a minimum spanning tree based on the max-min distance between points</p>
          </li>
          <li>
            <p>Operate on more than one layer</p>
          </li>
          <li>
            <p>Dissolve areal units and compute aggregate values</p>
          </li>
          <li>
            <p>Compute aggregate values based on a common indicator in a table</p>
          </li>
          <li>
            <p>Implement a spatial join to carry out point in polygon operations</p>
          </li>
          <li>
            <p>Visualize the common link between two layers</p>
          </li>
        </ul>
        <p><br></p>
        <div id="geoda-functions-covered" class="section level4 unnumbered" number="">
          <h4>GeoDa functions covered</h4>
          <ul>
            <li>File &gt; Save As</li>
            <li>Map &gt; Shape Centers</li>
            <li>Map &gt; Thiessen Polygons</li>
            <li>Map &gt; Minimum Spanning Tree</li>
            <li>Map &gt; Add Map Layer</li>
            <li>Map &gt; Map Layer Settings</li>
            <li>Tools &gt; Dissolve</li>
            <li>Table &gt; Aggregate</li>
            <li>Tools &gt; Spatial Join</li>
            <li>Map Layer Settings &gt; Set Highlight Association</li>
            <li>Map Layer Settings &gt; Change Associate Line Color</li>
          </ul>
          <p><br></p>
        </div>
      </div>
      <div id="preliminaries" class="section level3 unnumbered" number="">
        <h3>Preliminaries</h3>
        <p>We will continue to illustrate the various operations by means of a series of example data sets,
          all contained in the <a href="https://geodacenter.github.io/data-and-lab/">GeoDa Center data set
            collection</a>.</p>
        <p>Some of these are the same files used in the previous chapter. For the sake of completeness,
          we list all the sample data sets used:</p>
        <ul>
          <li>
            <p><a href="https://geodacenter.github.io/data-and-lab/commpop/">Chicago commpop</a>: population data for 77
              Chicago
              Community Areas in 2000 and 2010</p>
          </li>
          <li>
            <p><a href="https://geodacenter.github.io/data-and-lab//chicago_sup_vars/">Groceries</a>: the location of
              148 supermarkets
              in Chicago in 2015</p>
          </li>
          <li>
            <p><a href="https://geodacenter.github.io/data-and-lab/natregimes/">Natregimes</a>: homicide and
              socio-economic data for
              3085 U.S. counties in 1960-1990</p>
          </li>
          <li>
            <p><a href="https://geodacenter.github.io/data-and-lab//KingCounty-HouseSales2015/">Home Sales</a>: home
              sales in King County, WA
              during 2014-2015 (point data)</p>
          </li>
        </ul>
        <p>Make sure to have these data sets downloaded, unzipped and available in a working directory for analysis.</p>
      </div>
    </div>
    <div id="projections" class="section level2 unnumbered" number="">
      <h2>Projections</h2>
      <p>Spatial observations need to be georeferenced, i.e., associated with specific geometric objects for which the
        location is represented in a two-dimensional Cartesian coordinate system. Since all observations originate on
        the surface of the three-dimensional near-spherical earth, this requires a transformation. The transformation
        involves two steps that are often confused by non-geographers. The topic is complex and forms the basis for the
        discipline of <em>geodesy</em>. A detailed
        treatment is beyond our scope, but a good understanding of the fundamental concepts is important. The classic
        reference
        is <span class="citation">Snyder (<a href="#ref-Snyder:93" role="doc-biblioref">1993</a>)</span>, and a recent
        overview of a range of technical issues is offered in <span class="citation">Kessler and Battersby (<a
            href="#ref-KesslerBattersby:19" role="doc-biblioref">2019</a>)</span>.</p>
      <p>The basic building blocks are degrees latitude and longitude that situate each location with respect to the
        equator
        and the Greenwich Meridian (near London, England). Longitude is the horizontal dimension (x), and is measured in
        degrees East (positive) and West (negative) of
        Greenwich, ranging from 0 to 180 degrees. Since the U.S. is west of Greenwich, the longitude for U.S. locations
        is negative.
        Latitude is the vertical dimension (y), and is measured in degrees North (positive) and South (negative) of the
        equator, ranging
        from 0 to 90 degrees. Since the U.S. is in
        the northern hemisphere, its latitude values will be positive.</p>
      <p>In order to turn a geographic description, such as an address, into latitude-longitude degrees, we need to
        adhere to a so-called <em>geodetic datum</em>, a three-dimensional coordinate system or model that represents
        the shape of the earth. The most commonly used datum is the World Geodetic System of 1984, WGS 84, which
        represents the earth as an ellipsoid (and not as a perfect sphere). An earlier system, often used in older maps
        for North America, is NAD 83, the North American Datum of 1983.</p>
      <p>The second step consists of converting the latitude-longitude coordinates to Cartesian x-y coordinates in a
        planar system using a cartographic projection. Hundreds of projections have been developed, each addressing
        different aspects of the mathematical problem of converting a three-dimensional object (on a sphere or
        ellipsoid) to two dimensions (a flat map). In this conversion, every projection involves distortion of one or
        more fundamental properties of geographic objects: angles (sometimes confused with shape), area, distance and
        direction. It is important to be aware of this limitation, since many investigations rely on the computation of
        variables such as distance, or density (which involves area). The use of an inappropriate projection or distance
        metric may yield misleading results, especially for analyses that cover large areas (e.g, US-wide).</p>
      <p>For our purposes, two aspects are most important. One is to recognize whether spatial coordinates are projected
        (typically in units of feet or meters), or unprojected (i.e., in decimal degrees). To confuse matters more, the
        latter are sometimes
        referred to as a geographic projection, even though there is no projection involved. An operation such as
        Euclidean distance is only supported for projected coordinates. In many instances, <code>GeoDa</code> will
        generate a warning when an attempt to compute distances with decimal degrees is made, but this cannot be
        detected in all situations.</p>
      <p>A second important aspect is to make sure that layers are in the same projection when combined.
        <code>GeoDa</code> has some functionality to reproject layers on the fly to accomplish this, but it is not
        fail-safe.</p>
      <div id="coordinate-reference-system-crs" class="section level3 unnumbered" number="">
        <h3>Coordinate reference system (CRS)</h3>
        <p>A <em>coordinate reference system</em> or CRS is a formal representation of location. It typically contains
          both a datum and
          a particular projection, as well as some information on the location of the coordinate center, units of
          measurement and
          related items. A CRS is typically referred to by a code, such as an <em>EPSG code</em>, originally developed
          by the
          European Petroleum Survey Group.</p>
        <p>Interestingly, the <em>lack</em> of a projection, i.e., simple latitude-longitude degrees, has an EPSG code
          of <strong>4326</strong>.
          Often, this will be the point of departure, after which a transformation can be performed to obtain an actual
          projected data set.</p>
        <p>As we saw in the previous chapter, when a layer is saved in <code>GeoDa</code>, it is important to specify
          the CRS, even
          if the data is latitude-longitude. The CRS entry in the save dialog uses the <strong>proj4</strong>
          convention, which
          is compatible with the open source <a href="https://proj.org">PROJ</a> library upon which the projection
          functionality
          in <code>GeoDa</code> is build.</p>
        <p>An extremely useful
          resource is the <a href="https://spatialreference.org">spatialreference.org</a> web site, which contains
          literally hundreds
          of projection definitions. For example, Figure <a href="#fig:epsg">1</a> shows the entry for <strong>EPSG
            4326</strong>. It lists the
          important parameters and provide options to generate a CRS in a range of formats.</p>
        <div class="figure" style="text-align: center"><span id="fig:epsg"></span>
          <img src="pics1b/00_epsg4326.png" alt="EPSG 4326" width="60%" />
          <p class="caption">
            Figure 1: EPSG 4326
          </p>
        </div>
        <p>As mentioned, <code>GeoDa</code> uses the <strong>proj4</strong> format. When this is selected from the list
          on the web site, the following
          description is generated:</p>
        <p><strong>+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs </strong></p>
        <p>This is the proper definition to be entered into the CRS box when saving an unprojected (lat-lon) spatial
          layer.</p>
      </div>
      <div id="selecting-a-projection" class="section level3 unnumbered" number="">
        <h3>Selecting a projection</h3>
        <p>Non-cartographers are often at a loss when needing to select a projection to convert geographic data that are
          provided with latitude-longitude coordinates. While it is possible to use great circle distance (or, arc
          distance)
          to compute the distance between locations using lat-lon, the implementation in <code>GeoDa</code> is only an
          approximation.
          In order to use Euclidean distance, we need to project the data.</p>
        <p>For North America, a useful projection is <em>universal transverse Mercator</em> or UTM. The country is
          divided into
          parallel zones, as shown in Figure <a href="#fig:utmzones">2</a>. With each zone corresponds a specific
          projection that
          is contained in an ESPG code.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
        <div class="figure" style="text-align: center"><span id="fig:utmzones"></span>
          <img src="pics1b/00_utm_zones.png" alt="UTM zones for North America (source: GISGeography)" width="80%" />
          <p class="caption">
            Figure 2: UTM zones for North America (source: GISGeography)
          </p>
        </div>
        <p>Let’s say we need a projection for locations in Chicago. From the map, we can see that this city is located
          in
          UTM zone 16 (north – there is a southern hemisphere equivalent). We can now search the <a
            href="https://spatialreference.org">spatialreference.org</a> site for this projection. The search results
          are
          shown in Figure <a href="#fig:utmsearch">3</a>. Rather than a single code, a whole list of combinations of
          different
          datums is provided.</p>
        <div class="figure" style="text-align: center"><span id="fig:utmsearch"></span>
          <img src="pics1b/00_utm16n_search.png" alt="Projections for UTM Zone 16N" width="50%" />
          <p class="caption">
            Figure 3: Projections for UTM Zone 16N
          </p>
        </div>
        <p>We select the more recent WGS84 datum with associated EPSG code <strong>32616</strong>. This yields the
          information
          shown in Figure <a href="#fig:epsg32616">4</a>.</p>
        <div class="figure" style="text-align: center"><span id="fig:epsg32616"></span>
          <img src="pics1b/00_epsg32616.png" alt="EPSG code 32616" width="60%" />
          <p class="caption">
            Figure 4: EPSG code 32616
          </p>
        </div>
        <p>We choose the proj4 format, which yields the following CRS:</p>
        <p><strong>+proj=utm +zone=16 +ellps=WGS84 +datum=WGS84 +units=m +no_defs</strong></p>
        <p>In order to change the projection of a lat-lon layer (EPSG 4326) to UTM Zone 16N, we need to enter
          this code in the CRS box when executing a <strong>Save As</strong> command. This will result in a new layer
          with
          the proper projection.</p>
      </div>
      <div id="reprojection" class="section level3 unnumbered" number="">
        <h3>Reprojection</h3>
        <p>The procedure just described requires the manual entry of the correct CRS code. In practice,
          this can create problems due to typographical errors or other imprecisions. The <strong>Save As</strong>
          process in <code>GeoDa</code> provides an alternative that does not need an explicit entry, but
          requires the presence of another layer with the desired projection. The CRS information
          is then copied from that other layer and used in the <em>reprojection</em> of a current layer.</p>
        <p>For example, consider the 77 Chicago community areas contained in the <strong>commpop.shp</strong> shape
          file.
          As we saw in the previous chapter, this layer is expressed in latitude-longitude coordinates and
          takes on the familiar shape, shown in Figure <a href="#fig:chicagolat">5</a>.</p>
        <div class="figure" style="text-align: center"><span id="fig:chicagolat"></span>
          <img src="pics1b/00_commpoplatlon.png" alt="Chicago community areas in lat-lon" width="60%" />
          <p class="caption">
            Figure 5: Chicago community areas in lat-lon
          </p>
        </div>
        <p>Say we want to convert this layer to the same projection as the supermarket locations, contained
          in the <strong>chicago_sup.shp</strong> shape file. We proceed with <strong>File &gt; Save As</strong>. After
          entering a name for the
          new file, say <strong>commpop_proj</strong>, we can change the CRS information. The entry corresponding to the
          lat-lon
          layer is as in Figure <a href="#fig:loadcrs">6</a>. The small globe icon to the right allows us to load a CRS
          specification from another file.</p>
        <div class="figure" style="text-align: center"><span id="fig:loadcrs"></span>
          <img src="pics1b/00_load_crs.png" alt="Load CRS from another layer" width="60%" />
          <p class="caption">
            Figure 6: Load CRS from another layer
          </p>
        </div>
        <p>Selecting this icon brings up a file load interface into which we drag the <strong>chicago_sup.shp</strong>
          file.
          At this point, the CRS information in the box changes to the new projection, as shown in Figure <a
            href="#fig:newcrs">7</a>.</p>
        <div class="figure" style="text-align: center"><span id="fig:newcrs"></span>
          <img src="pics1b/00_newcrs.png" alt="New CRS from another layer" width="60%" />
          <p class="caption">
            Figure 7: New CRS from another layer
          </p>
        </div>
        <p>After saving the new file, we close the current project and load the new layer. The corresponding themeless
          base
          map is as in Figure <a href="#fig:chicagoproj">8</a>. The more compressed shape matches the layout of the
          supermarkets
          that we saw in the previous chapter.</p>
        <div class="figure" style="text-align: center"><span id="fig:chicagoproj"></span>
          <img src="pics1b/00_commpop_projected.png" alt="Reprojected Chicago community areas layer" width="60%" />
          <p class="caption">
            Figure 8: Reprojected Chicago community areas layer
          </p>
        </div>
      </div>
    </div>
    <div id="converting-between-points-and-polygons" class="section level2 unnumbered" number="">
      <h2>Converting Between Points and Polygons</h2>
      <p>So far, we have represented the geography of the community areas by their actual boundaries. However, this is
        not the only possible way. We can equally well choose a representative point for each area, such as a <em>mean
          center</em>
        or a <em>centroid</em>. In addition, we can create new polygons to represent the community areas as
        tessellations around
        those central points, such as <em>Thiessen polygons</em>. The key factor is that all three representations are
        connected to the same cross-sectional data set. As we will see in later chapters, for some types of analyses it
        is advantageous to
        treat the areal units as points, whereas in other situations Thiessen polygons form a useful alternative to
        dealing
        with an actual point layer.</p>
      <p>The center point and Thiessen polygon functionality is brought up through the options menu associated with any
        map view (right click on the map to bring up the menu). We illustrate these features with the projected
        community
        area map we just created.</p>
      <div id="mean-centers-and-centroids" class="section level3 unnumbered" number="">
        <h3>Mean centers and centroids</h3>
        <p>The <strong>Shape Centers</strong> option, shown in Figure <a href="#fig:centroidoption">9</a>, applies to
          polygon layers and offers a number of different
          alternatives. All options pertain to either the <strong>Mean Center</strong> or to the
          <strong>Centroid</strong>. The former is obtained as the simple average of the the X and Y coordinates that
          define the vertices of the polygon. The latter is more complex, and is the actual center of mass of the
          polygon (image a cardboard cutout of the polygon, the centroid is the central point where a pin would hold up
          the cutout in a stable equilibrium).</p>
        <p>Both methods can yield strange results when the polygons are highly irregular or in a so-called multi-polygon
          situation (different polygons associated with the same ID, such as a mainland area and an island belonging to
          the same county). In those instances the centers can end up being located outside the polygon. Nevertheless,
          the shape centers are a handy way to convert a polygon layer to a corresponding point layer with the same
          underlying geography. For example, as we will see
          in a later chapter, they are used under the hood to calculate distance-based spatial weights for polygons.</p>
        <div class="figure" style="text-align: center"><span id="fig:centroidoption"></span>
          <img src="pics1b/11_savecentroids.png" alt="Centroids and mean centers options" width="40%" />
          <p class="caption">
            Figure 9: Centroids and mean centers options
          </p>
        </div>
        <p>There are three main operations associated with the central points. The simplest is to
          <strong>Display</strong> the points
          on the map. This is purely illustrative and the points are not available for any further manipulation. This
          contrasts
          with the multi-layer option discussed below. For example, in Figure <a href="#fig:displaycentroid">10</a>, the
          community area centroids are displayed on top of the default
          themeless map.</p>
        <div class="figure" style="text-align: center"><span id="fig:displaycentroid"></span>
          <img src="pics1b/11_displaycent.png" alt="Display centroids on map" width="60%" />
          <p class="caption">
            Figure 10: Display centroids on map
          </p>
        </div>
        <p>As second option is the <strong>Add</strong> the coordinates of the central points <strong>to Table</strong>.
          This brings up a dialog
          that prompts for the variable names for the coordinates, as in Figure <a href="#fig:addcentroid">11</a>.</p>
        <div class="figure" style="text-align: center"><span id="fig:addcentroid"></span>
          <img src="pics1b/11_addcentroids.png" alt="Add centroids to table" width="25%" />
          <p class="caption">
            Figure 11: Add centroids to table
          </p>
        </div>
        <p>The new variables are added to the data table, as shown in Figure <a href="#fig:centroidintable">12</a>. At
          this point,
          we could use the <strong>Tools &gt; Points from Table</strong> option to turn the coordinates into a separate
          point layer.
          However, this can also be done directly by choosing the <strong>Save</strong> central point option.</p>
        <div class="figure" style="text-align: center"><span id="fig:centroidintable"></span>
          <img src="pics1b/11_centroids_in_table.png" alt="Centroids added to table" width="80%" />
          <p class="caption">
            Figure 12: Centroids added to table
          </p>
        </div>
        <p>The <strong>Save</strong> option results in the usual prompt for a file name (e.g.,
          <strong>comm_centroid</strong>) and creates the new layer. In our
          example, the point layer associated with the community area centroids is as in Figure <a
            href="#fig:centroidlayer">13</a>.</p>
        <div class="figure" style="text-align: center"><span id="fig:centroidlayer"></span>
          <img src="pics1b/11_centroid_map.png" alt="Chicago community area centroid layer" width="60%" />
          <p class="caption">
            Figure 13: Chicago community area centroid layer
          </p>
        </div>
      </div>
      <div id="thiessen-polygons" class="section level3 unnumbered" number="">
        <h3>Thiessen polygons</h3>
        <p>Point layers can be turned into a so-called tessellation or regular tiling of polygons centered around the
          points. Thiessen polygons are those polygons that define an area that is closer to the central point than
          to any other point. In other words, the polygon contains all possible locations that are nearest neighbors to
          the central point, rather than to any other point in the data set.
          The polygons are constructed by considering a line perpendicular at the midpoint to a line
          connecting the central point to its neighbors.</p>
        <p>The <strong>Thiessen Polygons</strong> functionality is available as an option in the map view for point
          layers, as
          shown in Figure <a href="#fig:thiessenoptions">14</a> for the <strong>comm_centroid</strong> layer.</p>
        <div class="figure" style="text-align: center"><span id="fig:thiessenoptions"></span>
          <img src="pics1b/11_thiessen.png" alt="Thiessen polygons option" width="40%" />
          <p class="caption">
            Figure 14: Thiessen polygons option
          </p>
        </div>
        <p>Again, we have the option to simply <strong>Display</strong> the polygons on top of the point layer, as in
          Figure <a href="#fig:thiessendisplay">15</a>, but this does
          not allow for any analysis.</p>
        <div class="figure" style="text-align: center"><span id="fig:thiessendisplay"></span>
          <img src="pics1b/11_display_thiessen.png" alt="Display Thiessen polygons" width="60%" />
          <p class="caption">
            Figure 15: Display Thiessen polygons
          </p>
        </div>
        <p>Alternatively, we can <strong>Save</strong> the Thiessen polygons to a new layer in the usual fashion. For
          example, in Figure <a href="#fig:thiessenmap">16</a>,
          we show the themeless base map of the layer associated with a <strong>chi_thiessen</strong> shape file that we
          just created.</p>
        <div class="figure" style="text-align: center"><span id="fig:thiessenmap"></span>
          <img src="pics1b/11_chi_thiessenmap.png" alt="Thiessen polygon layer" width="60%" />
          <p class="caption">
            Figure 16: Thiessen polygon layer
          </p>
        </div>
      </div>
    </div>
    <div id="minimum-spanning-tree-mst" class="section level2 unnumbered" number="">
      <h2>Minimum Spanning Tree (MST)</h2>
      <p>A graph is a data structure that consists of nodes and vertices connecting these nodes. In our later
        discussions, we will often encounter a <em>connectivity graph</em>, which shows the observations that
        are connected for a given distance band. The connected points are separated by a distance that is
        smaller than the specified distance band.</p>
      <p>An important graph is the so-called max-min connectivity graph,
        which shows the connectedness structure among points for the smallest distance band that guarantees
        that each point has at least one other point it is connected to.</p>
      <p>A <em>minimum spanning tree</em> (MST) associated with a graph is a path through the graph that ensures that
        each node is
        visited once and which achieves a minimum cost objective. A typical application is to minimize
        the total distance traveled through the path. The MST is employed in a range of methods, particularly
        clustering algorithms.</p>
      <p><code>GeoDa</code> constructs an MST based on the max-min connectivity graph for any point layer. This is an
        option
        in the map menu for a point layer, as illustrated in Figure <a href="#fig:mstoption">17</a> for the
        <strong>chicago_sup.shp</strong> layer.</p>
      <div class="figure" style="text-align: center"><span id="fig:mstoption"></span>
        <img src="pics1b/22_mst.png" alt="MST option in a point map layer" width="40%" />
        <p class="caption">
          Figure 17: MST option in a point map layer
        </p>
      </div>
      <p>The construction of the MST employs <em>Prim’s algorithm</em>, which is illustrated in more detail in the <a
          href="#appendix">Appendix</a>.
        The <strong>Minimum Spanning Tree</strong> function has several options. The critical one is <strong>Display
          Minimum Spanning Tree</strong>.
        The graph is shown on top of the point layer. <strong>Change Edge Thickness</strong> and <strong>Change Edge
          Color</strong> allow for some
        customization. For example, in the MST shown in Figure <a href="#fig:mstchicago">18</a>, the edge thickness was
        changed to <strong>Strong</strong> and
        the edge color to <strong>Red</strong>. The graph clearly illustrates how each node is visited.</p>
      <div class="figure" style="text-align: center"><span id="fig:mstchicago"></span>
        <img src="pics1b/22_mst_map.png" alt="MST graph for Chicago grocery stores" width="60%" />
        <p class="caption">
          Figure 18: MST graph for Chicago grocery stores
        </p>
      </div>
      <p>A further option is to <strong>Save Minimum Spanning Tree</strong>, which creates a file that follows the
        <strong>gwt</strong> spatial weights
        format. This is discussed more in depth in the chapters dealing with spatial weights.</p>
    </div>
    <div id="aggregation" class="section level2 unnumbered" number="">
      <h2>Aggregation</h2>
      <p>Spatial data sets often contain identifiers of larger encompassing units, such as states for counties, or
        census
        tracts for individual household data. <code>GeoDa</code> supports two different ways to compute aggregates from
        the smaller units.
        One approach also creates a <em>dissolved</em> map, the other is limited to computing a new table with the
        aggregate information.</p>
      <div id="dissolve" class="section level3 unnumbered" number="">
        <h3>Dissolve</h3>
        <p>The <strong>Tools &gt; Dissolve</strong> function, is invoked from the <strong>Tools</strong> icon on the
          toolbar, as shown in Figure <a href="#fig:toolsdissolve">19</a>, or from the menu.</p>
        <div class="figure" style="text-align: center"><span id="fig:toolsdissolve"></span>
          <img src="pics1b/33_tools_dissolve.png" alt="Dissolve option" width="15%" />
          <p class="caption">
            Figure 19: Dissolve option
          </p>
        </div>
        <p>We illustrate this functionality with the <strong>natregimes</strong> shape file. While the observations are
          for counties, each
          county also includes a <em>numeric</em> code for the encompassing state in the variable
          <strong>STFIPS</strong>. We specify this as the
          <strong>variable for dissolving</strong> in the dialog shown in Figure <a href="#fig:dissolvedialog">20</a>.
          Next we need to select the variables
          for which we want to calculate the aggregate values. We need to be mindful of the type of variable that is
          appropriate
          for the selected aggregation <strong>Method</strong>, a choice from <strong>Average</strong>,
          <strong>Max</strong>, <strong>Min</strong>, and <strong>Sum</strong>. The <strong>Count</strong> function
          doesn’t actually compute any aggregate values, but provides a count of the number of smaller units included in
          the
          larger unit (e.g., the number of counties in each state).
        </p>
        <p>In our example, we want to aggregate the homicide count, <strong>HC60</strong>, and population,
          <strong>PO60</strong>. We select these variables
          by double clicking on them, or choosing them and then using the <strong>&gt;</strong> key. We also specify
          <strong>Sum</strong> as the method. The dialog in Figure <a href="#fig:dissolvedialog">20</a>
          shows all the details.</p>
        <div class="figure" style="text-align: center"><span id="fig:dissolvedialog"></span>
          <img src="pics1b/33_dissolve_dialog.png" alt="Dissolve dialog" width="40%" />
          <p class="caption">
            Figure 20: Dissolve dialog
          </p>
        </div>
        <p>After activating the <strong>Dissolve</strong> button, the usual file creation dialog is produced that allows
          us to specify
          a file type and file name. In our example, we created the <strong>states.shp</strong> shape file.</p>
        <p>After closing the project and loading this shape file, we obtain a themeless base map with the 49 states
          outlines (and
          Washinton, DC), shown in Figure <a href="#fig:dissolvedmap">21</a>.</p>
        <div class="figure" style="text-align: center"><span id="fig:dissolvedmap"></span>
          <img src="pics1b/33_states_map.png" alt="Dissolved states map" width="60%" />
          <p class="caption">
            Figure 21: Dissolved states map
          </p>
        </div>
        <p>The associated table, in Figure <a href="#fig:dissolvedtable">22</a>, shows the entries for the state
          aggregates, as well
          as a new variable, <strong>AGG_COUNT</strong>, which indicates the number of counties aggregated into the
          respective state.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
        <div class="figure" style="text-align: center"><span id="fig:dissolvedtable"></span>
          <img src="pics1b/33_states_table.png" alt="Dissolved states table" width="35%" />
          <p class="caption">
            Figure 22: Dissolved states table
          </p>
        </div>
      </div>
      <div id="aggregation-in-table" class="section level3 unnumbered" number="">
        <h3>Aggregation in table</h3>
        <p>The same aggregation function is also available as an option for the table, as shown in Figure <a
            href="#fig:aggoption">23</a>.
          The main difference with the <strong>Dissolve</strong> function is that the results are only available as a
          table, without an
          associated dissolved map.</p>
        <div class="figure" style="text-align: center"><span id="fig:aggoption"></span>
          <img src="pics1b/33_aggregate.png" alt="Aggregate option in table" width="20%" />
          <p class="caption">
            Figure 23: Aggregate option in table
          </p>
        </div>
        <p>The aggregation dialog is very similar to the previous one, as illustrated in Figure <a
            href="#fig:aggdialog">24</a>.
          We need to choose a <strong>Select key</strong>, a numeric variable following which the aggregation will be
          carried out.
          In our example, we again choose <strong>STFIPS</strong>. We also need to select a <strong>Method</strong>,
          <strong>Sum</strong> in our example, as
          well as the respective variables, here again <strong>HC60</strong> and <strong>PO60</strong>. If we save the
          result as a table (e.g., in <strong>dbf</strong>
          format), the end result is identical to Figure <a href="#fig:dissolvedtable">22</a>.</p>
        <div class="figure" style="text-align: center"><span id="fig:aggdialog"></span>
          <img src="pics1b/33_aggregate_dialog.png" alt="Aggregate dialog" width="40%" />
          <p class="caption">
            Figure 24: Aggregate dialog
          </p>
        </div>
      </div>
    </div>
    <div id="multi-layer-support" class="section level2 unnumbered" number="">
      <h2>Multi-Layer Support</h2>
      <p>So far, we have focused on a single spatial layer. <code>GeoDa</code> has limited functionality to handle
        multiple layers.
        The functionality is limited in that any selection, transformation or other manipulation only applies to the
        <em>current map layer</em>, i.e., the layer that is loaded first. The data table associated with this layer is
        the only
        data that can be changed.
      </p>
      <p>There is limited support for interaction between layers, in the form of <em>spatial join</em> and
        <em>highlighted assocations</em>,
        discussed in the last two sections. In the current section, we present the basics of the multiple layer logic
        in <code>GeoDa</code>.</p>
      <div id="loading-multiple-layers" class="section level3 unnumbered" number="">
        <h3>Loading multiple layers</h3>
        <p>We start by loading the supermarket point layer from the <strong>chicago_sup.shp</strong> file. The resulting
          base map
          is as in Figure <a href="#fig:addlayer">25</a>. We add a second layer by clicking on the <strong>Add Map
            Layer</strong> icon in the
          toolbar, the <strong>+</strong> sign as the third item from the left.</p>
        <div class="figure" style="text-align: center"><span id="fig:addlayer"></span>
          <img src="pics1b/99_addlayer.png" alt="Add map layer icon" width="60%" />
          <p class="caption">
            Figure 25: Add map layer icon
          </p>
        </div>
        <p>This brings up the usual data input interface, to which we load the <em>projected</em> community area file
          from
          <strong>commpop_proj.shp</strong>. We now have two layers, as in Figure <a href="#fig:layersettings">26</a>.
          The interaction between
          the two layers is managed by the <strong>Map Layer Settings</strong> dialog, invoked from the fourth icon from
          the left on the toolbar.
          This lists the layers in the order in which they appear on the map. In our example, this is the point layer on
          top and the area layer below. The dialog also clearly indicates which is the main or <strong>current
            map</strong> layer, i.e.,
          <strong>chicago_sup</strong>.
        </p>
        <div class="figure" style="text-align: center"><span id="fig:layersettings"></span>
          <img src="pics1b/99_maplayersettings.png" alt="Map layer settings" width="60%" />
          <p class="caption">
            Figure 26: Map layer settings
          </p>
        </div>
        <p>The properties of the top layer, such as fill color and outline color are set in the standard manner, by
          clicking on the green rectangle in the legend. In order to set the properties of the other layers, we need
          to click on the small rectangle in the <strong>Map Layer Settings</strong> dialog that corresponds to the
          layer of interest. This provides access to the
          <strong>Fill Color</strong> and <strong>Outline Color</strong>, as in Figure <a
            href="#fig:settingoptions">27</a>. In addition to the color, it may
          be necessary to adjust the <strong>opacity</strong> in order to make sure that the relevant information is
          visible.
          The interface also includes options to set the association highlight, which we discuss in a later section.
          The final item in the dialog allows us to <strong>Remove</strong> the layer.
        </p>
        <div class="figure" style="text-align: center"><span id="fig:settingoptions"></span>
          <img src="pics1b/99_maplayer_options.png" alt="Customizing the second map layer" width="30%" />
          <p class="caption">
            Figure 27: Customizing the second map layer
          </p>
        </div>
      </div>
      <div id="automatic-reprojection" class="section level3 unnumbered" number="">
        <h3>Automatic reprojection</h3>
        <p>In the previous example, we made sure to combine two layers that were expressed in the same projection.
          However, as long as layers have projection information associated with them, <code>GeoDa</code> will
          automatically
          <em>reproject</em> any later layers to the projection of the <em>current</em> layer. This is for visualization
          only, it
          does not change the projection information of the reprojected layers.
        </p>
        <p>For example, in Figure <a href="#fig:reproj">28</a>, we first loaded the <strong>commpop</strong> layer which
          was not projected, but
          expressed in lat-lon coordinates. However, since we included the projection information with the layer, the
          points from the second layer, <strong>chicago_sup</strong>, are automatically turned into lat-lon as well. We
          see the slightly more spread
          out pattern in Figure <a href="#fig:reproj">28</a> compared to Figure <a href="#fig:layersettings">26</a>.
          Note that we had to
          change the <strong>opacity</strong> of the top layer (the community areas) to 0 in order to make the points
          visible.</p>
        <div class="figure" style="text-align: center"><span id="fig:reproj"></span>
          <img src="pics1b/99_compop_opacity0.png" alt="Points reprojected to lat-lon" width="60%" />
          <p class="caption">
            Figure 28: Points reprojected to lat-lon
          </p>
        </div>
      </div>
      <div id="layer-position" class="section level3 unnumbered" number="">
        <h3>Layer position</h3>
        <p>The position of the layers can be altered by means of the <strong>Map Layer Settings</strong> interface. One
          grabs the entry
          for a layer and drags it to a different position. For example, in Figure <a href="#fig:layerpos">29</a>, we
          have moved the point
          layer on top of the community area layer. However, even though the point layer is now on top, the community
          area layer remains the <strong>current map</strong> layer, since it was loaded first.</p>
        <div class="figure" style="text-align: center"><span id="fig:layerpos"></span>
          <img src="pics1b/99_movelayers.png" alt="Change the position of the map layers" width="30%" />
          <p class="caption">
            Figure 29: Change the position of the map layers
          </p>
        </div>
        <p>The result is the map in Figure <a href="#fig:pointtop">30</a>. Note how, in contrast to Figure <a
            href="#fig:reproj">28</a>, we now do <em>not</em> need
          to change the opacity of the community area layer. Since the point layer is on top, it is drawn <em>after</em>
          the community
          area, so the points will always be visible.</p>
        <div class="figure" style="text-align: center"><span id="fig:pointtop"></span>
          <img src="pics1b/99_pointsontop.png" alt="Points layer moved to top" width="60%" />
          <p class="caption">
            Figure 30: Points layer moved to top
          </p>
        </div>
      </div>
      <div id="selection" class="section level3 unnumbered" number="">
        <h3>Selection</h3>
        <p>It is important to keep in mind that any <em>selection</em> only pertains to the <strong>current map</strong>
          layer, which may or may
          not also be the top layer. For example, in Figure <a href="#fig:pointselect">31</a> (based on the setup
          shown in Figure <a href="#fig:layersettings">26</a>), the <strong>current map</strong> layer is the points
          layer <strong>chicago_sup</strong>, which is also on top. Any selection highlights points and provides the
          same selection in
          any other open map or graph through the <em>linking</em> capacity (discussed in more detail in later
          chapters).</p>
        <div class="figure" style="text-align: center"><span id="fig:pointselect"></span>
          <img src="pics1b/99_select_on_points.png" alt="Select on current points layer -- points on top" width="60%" />
          <p class="caption">
            Figure 31: Select on current points layer – points on top
          </p>
        </div>
        <p>In contrast, in Figure <a href="#fig:areaselect">32</a> (based on the setup in Figure <a
            href="#fig:pointtop">30</a>), the selection
          pertains to the community areas, which is the <strong>current map</strong> layer, even though the point layer
          is on top.
          This may seem a bit counter-intuitive at first, but it is based on the linking and brushing architecture
          implemented
          in <code>GeoDa</code>. Currently, this logic works only for a single layer, which is always the first loaded
          layer.</p>
        <p>For example, when
          the selection is initialized in a different single layer map, this map will pertain to the community areas and
          not
          to the added point layer. In the section on <a href="#linked-multi-layers">Linked Multi-Layers</a>, we
          describe a way to connect the selection
          between two layers.</p>
        <div class="figure" style="text-align: center"><span id="fig:areaselect"></span>
          <img src="pics1b/99_select_on_comm.png" alt="Select on current area layer -- points on top" width="60%" />
          <p class="caption">
            Figure 32: Select on current area layer – points on top
          </p>
        </div>
      </div>
    </div>
    <div id="spatial-join" class="section level2 unnumbered" number="">
      <h2>Spatial Join</h2>
      <p>The multi-layer infrastructure allows for the calculation of variables for one layer, based on the
        observations in a different layer. This is an example of a <em>point in polygon</em> GIS operation. There are
        two applications of this process. In one, the ID variable (or any other variable) of a spatial area
        is <em>assigned</em> to each point that is within the area’s boundary. We refer to this as <strong>Spatial
          Assign</strong>.
        The reverse of this process is to <em>count</em> (or otherwise aggregate) the number of points that are within
        a given area. We refer to this as <strong>Spatial Count</strong>.</p>
      <p>Even though the default application is simply assigning an ID or counting the number of points, more
        complex assignments and aggregations are possible as well. For example, rather than just counting the
        point, an aggregate over the points can be computed for a given variable, such as the mean, median,
        standard deviation, or
        sum.</p>
      <p>It is important to keep in mind the <em>order</em> in which the layers are loaded into the multi-layer setup.
        For spatial assign, the point layer is first, since the community area ID (or other variable) is
        assigned to each point. As mentioned before, only the table of the first loaded layer is available
        for manipulation or analysis. So, in order to add the ID code to the point layer table, it must be loaded
        first.</p>
      <p>For spatial count, the reverse it the case. We need to first load the polygon layer, since the
        number of points (or any other aggregation) is added to the table for the areal units.</p>
      <div id="spatial-assign" class="section level3 unnumbered" number="">
        <h3>Spatial assign</h3>
        <p>We start the process illustrating the <strong>Spatial Assign</strong> operation by first loading the Chicago
          supermarkets point layer, <strong>chicago_sup.shp</strong>, followed by the projected community area layer,
          <strong>commpop_proj.shp</strong> (using the <strong>+</strong> icon in the toolbar). This yields the base map
          shown in Figure <a href="#fig:spjoin1">33</a>.
        </p>
        <div class="figure" style="text-align: center"><span id="fig:spjoin1"></span>
          <img src="pics1b/88_spatialjoin1.png" alt="Supermarket point layer on top of community areas" width="60%" />
          <p class="caption">
            Figure 33: Supermarket point layer on top of community areas
          </p>
        </div>
        <p>We invoke the point in polygon operation from the menu as <strong>Tools &gt; Spatial Join</strong>, or from
          the <strong>Tools</strong> icon
          on the toolbar, in the usual way. This brings up the main dialog, which differs between the spatial assign
          and the spatial count functions.</p>
        <p>Figure <a href="#fig:spjoindialog1">34</a> shows how the <strong>current map</strong> layer,
          <strong>chicago_sup</strong> is joined to another layer. In our example, there is only one other layer, i.e.,
          <strong>commpop_proj</strong>, but in general, there
          could be several layers to select from. The <strong>ID Variable</strong> contains the value that will be
          assigned to each point.
          In our example, this is the community area id, <strong>NID</strong>.</p>
        <div class="figure" style="text-align: center"><span id="fig:spjoindialog1"></span>
          <img src="pics1b/55_pointinpoly_dialog.png" alt="Spatial join dialog -- community area for point"
            width="40%" />
          <p class="caption">
            Figure 34: Spatial join dialog – community area for point
          </p>
        </div>
        <p>Clicking <strong>OK</strong> brings up the dialog for the variable name of the spatial assign variable, which
          is <strong>SA</strong> by default.
          As shown in Figure <a href="#fig:spjoindvar1">35</a>, we keep the default in our example.</p>
        <div class="figure" style="text-align: center"><span id="fig:spjoindvar1"></span>
          <img src="pics1b/55_spatial_assign.png" alt="Spatial assign -- community area variable" width="20%" />
          <p class="caption">
            Figure 35: Spatial assign – community area variable
          </p>
        </div>
        <p>After this, the community area ID is added to the point data table as the variable <strong>SA</strong>, as in
          Figure <a href="#fig:saintable">36</a>.</p>
        <div class="figure" style="text-align: center"><span id="fig:saintable"></span>
          <img src="pics1b/55_SA_intable.png" alt="Community area in point table" width="80%" />
          <p class="caption">
            Figure 36: Community area in point table
          </p>
        </div>
        <p>We can now readily identify the supermarkets that are located within a given community area. For
          example, in Figure <a href="#fig:hydepark">37</a>, we used the <strong>Selection Tool</strong> on the point
          layer to select the supermarkets
          with <strong>NID = 41</strong>, the community area code for Hyde Park. The three points are clearly identified
          on the map.</p>
        <div class="figure" style="text-align: center"><span id="fig:hydepark"></span>
          <img src="pics1b/88_HydePark_selected.png" alt="Grocery stores in Hyde Park" width="60%" />
          <p class="caption">
            Figure 37: Grocery stores in Hyde Park
          </p>
        </div>
      </div>
      <div id="spatial-count" class="section level3 unnumbered" number="">
        <h3>Spatial count</h3>
        <p>The <strong>Spatial Count</strong> process works in the reverse order. We first load the community area
          layer,
          <strong>commpop_proj.shp</strong>, followed by the supermarket point layer, <strong>chicago_sup.shp</strong>.
          In order to
          make the points visible (since the community area map is on top), we change the opacity of the <strong>Fill
            Color</strong> of the community areas to 0,
          and change the <strong>Fill Color</strong> of the point layer to blue. This yields the map in Figure <a
            href="#fig:spjoin2">38</a>.
        </p>
        <div class="figure" style="text-align: center"><span id="fig:spjoin2"></span>
          <img src="pics1b/55_spatialjoin2.png" alt="Community area layer on top of supermarkets" width="60%" />
          <p class="caption">
            Figure 38: Community area layer on top of supermarkets
          </p>
        </div>
        <p>We again invoke the process as <strong>Tools &gt; Spatial Join</strong>, but now the interface is slightly
          different, as
          in Figure <a href="#fig:spjoindialog2">39</a>. The <strong>current map</strong> is now the area layer,
          <strong>commpop_proj</strong>. Again,
          there is a drop down list to select the second layer, which in our example is simply
          <strong>chicago_sup</strong>. Since
          we are not carrying out any spatial aggregation on a specific variable, the radio button checked is left to
          the default <strong>Spatial Count</strong>.</p>
        <div class="figure" style="text-align: center"><span id="fig:spjoindialog2"></span>
          <img src="pics1b/100_spatialjoin1.png" alt="Spatial join dialog -- points for community area" width="50%" />
          <p class="caption">
            Figure 39: Spatial join dialog – points for community area
          </p>
        </div>
        <p>While we don’t illustrate this feature here, the spatial join operation can also carry out an aggregation
          over
          the points in each area. This allows us to select multiple variables that are available at the point level (in
          our
          example, there are no interesting variables other than location) and carry out one of the aggregation options
          <strong>Sum</strong>, <strong>Mean</strong>, <strong>Median</strong> and <strong>Standard Deviation</strong>,
          as listed in Figure <a href="#fig:spjoindialog3">40</a>.
        </p>
        <div class="figure" style="text-align: center"><span id="fig:spjoindialog3"></span>
          <img src="pics1b/100_spatialjoin2.png" alt="Spatial join dialog -- aggregation options" width="50%" />
          <p class="caption">
            Figure 40: Spatial join dialog – aggregation options
          </p>
        </div>
        <p>In our example, we want a simple count of supermarkets by community area, so we leave the radio
          button to <strong>Spatial Count</strong>. Clicking <strong>OK</strong> brings up the dialog to select the
          spatial count variable. In Figure <a href="#fig:spjoindvar2">41</a>,
          we keep the default as <strong>SC</strong>.</p>
        <div class="figure" style="text-align: center"><span id="fig:spjoindvar2"></span>
          <img src="pics1b/55_spatialcount.png" alt="Spatial count -- number of supermarkets" width="20%" />
          <p class="caption">
            Figure 41: Spatial count – number of supermarkets
          </p>
        </div>
        <p>Figure <a href="#fig:scintable">42</a> shows how the variable <strong>SC</strong> has been added as an
          additional column in
          the community area data table.</p>
        <div class="figure" style="text-align: center"><span id="fig:scintable"></span>
          <img src="pics1b/55_sc_intable.png" alt="Grocery count in community area table" width="60%" />
          <p class="caption">
            Figure 42: Grocery count in community area table
          </p>
        </div>
        <p>We can now use the <strong>Selection Tool</strong> on the community area layer to find out which community
          areas
          lack any supermarkets, by setting <strong>SC=0</strong>. The result is shown in Figure <a
            href="#fig:nogrocery">43</a>.</p>
        <div class="figure" style="text-align: center"><span id="fig:nogrocery"></span>
          <img src="pics1b/55_zerostores.png" alt="Community areas without supermarkets" width="60%" />
          <p class="caption">
            Figure 43: Community areas without supermarkets
          </p>
        </div>
        <p>As in any table operations, the results are not permanent until a <strong>Save</strong> command has been
          executed.</p>
      </div>
    </div>
    <div id="linked-multi-layers" class="section level2 unnumbered" number="">
      <h2>Linked Multi-Layers</h2>
      <p>In the previous example, we used the connection between two layers to compute a new variable. In addition,
        this connection can also be exploited to <em>highlight the association</em> between observations in one layer
        to observations in another layer, as long as these layers share a common <em>key</em>.</p>
      <p>A typical application of this feature is to show the connection between two point layers, e.g., where
        one contains headquarters and the second branches, connected by a shared corporate ID.</p>
      <p>Here, we will illustrate this functionality with the <strong>Home Sales</strong> sample data set, which
        contains house
        sale data for King county, Washington from the Kaggle competition. The aim of the competition was to develop
        the best predictor of house values. Each sale is associated with both a point location and a zip code. Our
        example illustrates a quality check, where we want to verify the correctness of the zip code zones (or the
        locations).</p>
      <p>To understand the linkage logic, it is important to realize that the connection is <em>from</em> selected
        observations in the <em>current</em> map layer
        <em>to</em> another layer. If the main layer is house sale points, then the linkage is between points and
        associated zip
        code zones. With the main layer as zip code zones, the connection is between zones and associated sale
        locations.
      </p>
      <div id="from-point-to-area" class="section level3 unnumbered" number="">
        <h3>From point to area</h3>
        <p>We start by loading the house sale location data from the <strong>kc_house.shp</strong> data set. Using the
          <strong>+</strong> icon, we add the
          <strong>King_county_zip.shp</strong> layer with the zip code zones. The point of departure is shown in Figure
          <a href="#fig:pt2area">44</a>.
          The <strong>Map Layer Settings</strong> indicates that <strong>kc_house</strong> is the <strong>current
            map</strong>, i.e., the main layer.
        </p>
        <div class="figure" style="text-align: center"><span id="fig:pt2area"></span>
          <img src="pics1b/77_kc_housemain.png" alt="King county house sales with zip code zones" width="60%" />
          <p class="caption">
            Figure 44: King county house sales with zip code zones
          </p>
        </div>
        <p>Right clicking on <strong>kc_house</strong> in the <strong>Map Layer Settings</strong> interface, triggers
          the options menu. From this,
          we select <strong>Set Highlight Association</strong>, as in Figure <a href="#fig:highlight">45</a>.</p>
        <div class="figure" style="text-align: center"><span id="fig:highlight"></span>
          <img src="pics1b/77_sethighlight1.png" alt="Set Highlight Assocation option" width="30%" />
          <p class="caption">
            Figure 45: Set Highlight Assocation option
          </p>
        </div>
        <p>This brings up the <strong>Set Association Dialog</strong> for the <strong>from</strong> layer, i.e.,
          <strong>kc_house</strong> (listed
          in parentheses), as shown in Figure <a href="#fig:assoc1">46</a>. From the drop down list, we select the
          <strong>to</strong> layer, which
          is <strong>King_coun…</strong> in our example. Next, we need to specify the common <strong>key</strong>. In
          the area layer, the numeric
          zip code is contained in <strong>ZIP</strong>, whereas in the point layer, it is the variable
          <strong>zipcode</strong>. For now, we
          keep the <strong>Show connect line</strong> box unchecked.</p>
        <div class="figure" style="text-align: center"><span id="fig:assoc1"></span>
          <img src="pics1b/77_association_house.png" alt="Set association dialog -- house sales" width="80%" />
          <p class="caption">
            Figure 46: Set association dialog – house sales
          </p>
        </div>
        <p>Clicking the <strong>OK</strong> button establishes the connection between a selection in the main layer and
          the associated
          observations in the other layer. For example, in Figure <a href="#fig:link1a">47</a>, we selected 806 house
          locations in the
          center of the map, and the associated zip code zones are highlighted. This contrasts with selection in the
          standard
          situation (without highlight association), where only the selected items for the main layer would be
          highlighted,
          as in Figure <a href="#fig:pointselect">31</a>.</p>
        <div class="figure" style="text-align: center"><span id="fig:link1a"></span>
          <img src="pics1b/77_houses_selected.png" alt="King county house sales selected with associates zip code zones"
            width="60%" />
          <p class="caption">
            Figure 47: King county house sales selected with associates zip code zones
          </p>
        </div>
        <p>With the <strong>Show connect line</strong> box checked, the connection is visualized by means of lines
          between the selected
          points and a center point for the zip code zone. In Figure <a href="#fig:link1">48</a>, we selected 16
          observations in the remote eastern
          part of the county and show the associated links (to enhance
          visibility we changed the <strong>Associate Line Color</strong> for <strong>kc_house</strong> to red). If the
          codes were correct, we
          would expect the lines to go to the center point of the zip code zone in which the points are located.
          However,
          in this instance, the connection is to zones that are quite removed, suggesting a coding error, either in the
          zip code zone or in the lat-lon for the sales location.</p>
        <div class="figure" style="text-align: center"><span id="fig:link1"></span>
          <img src="pics1b/77_houses_selectedwlink.png" alt="King county house sales with incorrect zip code zones"
            width="60%" />
          <p class="caption">
            Figure 48: King county house sales with incorrect zip code zones
          </p>
        </div>
      </div>
      <div id="from-area-to-point" class="section level3 unnumbered" number="">
        <h3>From area to point</h3>
        <p>We now illustrate the reverse logic. We start by loading the <strong>King_county_zip.shp</strong> layer and
          add the
          <strong>kc_house.shp</strong> data set. In order to make the points visible, we change the
          <strong>Opacity</strong> of the <strong>Fill Color</strong>
          of the zip code zone layer to 0 and the <strong>Outline Color</strong> for the points to blue. The result is
          shown in Figure <a href="#fig:area2pt">49</a>.
        </p>
        <div class="figure" style="text-align: center"><span id="fig:area2pt"></span>
          <img src="pics1b/77_zipontop.png" alt="King county zip code zones with house sales" width="60%" />
          <p class="caption">
            Figure 49: King county zip code zones with house sales
          </p>
        </div>
        <p>We again right click on the top layer (now the zip code zones) in the <strong>Map Layer Settings</strong>
          interface to
          select <strong>Set Highlight Association</strong>, in the same way as before. Now, the <strong>from</strong>
          layer in the
          <strong>Set Association Dialog</strong> is <strong>King_county_zip</strong>, as in Figure <a
            href="#fig:assoc2">50</a>. We select the <strong>to</strong> layer
          as <strong>kc_house</strong>, and again the <strong>key</strong> variable is <strong>zipcode</strong> in the
          point layer and <strong>ZIP</strong> in the area layer.
          With the <strong>Show connect line</strong> box checked, this establishes the connection.
        </p>
        <div class="figure" style="text-align: center"><span id="fig:assoc2"></span>
          <img src="pics1b/66_association2.png" alt="Set association dialog -- zip code zones" width="80%" />
          <p class="caption">
            Figure 50: Set association dialog – zip code zones
          </p>
        </div>
        <p>Now, if we select an observation in the main layer of zip code zones, the links to the house sales are shown
          (again, changing
          the link color to red for visibility). Most of the sales connect to a central point of the zip code zone,
          but several are linked to locations well beyond, confirming the likely coding error we identified before.</p>
        <div class="figure" style="text-align: center"><span id="fig:link2"></span>
          <img src="pics1b/77_association2.png" alt="King county zip code zones incorrect house sales" width="60%" />
          <p class="caption">
            Figure 51: King county zip code zones incorrect house sales
          </p>
        </div>
      </div>
    </div>
    <div id="appendix" class="section level2 unnumbered" number="">
      <h2>Appendix</h2>
      <div id="prims-minimum-spanning-tree-algorithm" class="section level3 unnumbered" number="">
        <h3>Prim’s Minimum Spanning Tree algorithm</h3>
        <p>We illustrate Prim’s MST algorithm by means of a small toy example consisting of 10 points. The
          coordinates of the points are given in Figure <a href="#fig:toypoints">52</a>.</p>
        <div class="figure" style="text-align: center"><span id="fig:toypoints"></span>
          <img src="pics1b/22_db_data.png" alt="Toy example point coordinates" width="20%" />
          <p class="caption">
            Figure 52: Toy example point coordinates
          </p>
        </div>
        <p>The corresponding inter-point distance matrix is given in Figure <a href="#fig:toydistance">53</a>.</p>
        <div class="figure" style="text-align: center"><span id="fig:toydistance"></span>
          <img src="pics1b/22_distance_matrix.png" alt="Inter-point distance matrix" width="60%" />
          <p class="caption">
            Figure 53: Inter-point distance matrix
          </p>
        </div>
        <p>We can now use the inter-point distances to construct a <em>connectivity graph</em> for a distance band that
          ensures
          that each point is connected to at least one other point. In our example, this distance is 29.15.<a
            href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> The corresponding graph representation
          is given in Figure <a href="#fig:graph0">54</a>, where each point is a node and the vertices show the
          connections and associated distances.</p>
        <div class="figure" style="text-align: center"><span id="fig:graph0"></span>
          <img src="pics1b/22_db_points_example0.png" alt="Connectivity graph" width="50%" />
          <p class="caption">
            Figure 54: Connectivity graph
          </p>
        </div>
        <p>Prim’s algorithm proceeds by starting at a random node and selecting the shortest vertex to the next node.
          Let’s say
          we start at node 1. Since there is only a single vertex, the first path is from node 1 to 2. At node 2, there
          are two
          vertices, 2-4 with length 15.81, and 2-6 with length 18.03. We therefore connect 2 to 4. So far, our shortest
          path follows
          the red lines as in Figure <a href="#fig:graph1">55</a>.</p>
        <div class="figure" style="text-align: center"><span id="fig:graph1"></span>
          <img src="pics1b/22_db_points_example1.png" alt="Initial steps in Prim's algorithm" width="50%" />
          <p class="caption">
            Figure 55: Initial steps in Prim’s algorithm
          </p>
        </div>
        <p>At node 4, the two vertices have the same length, so we can connect 4 to either 6 or 5. The order is
          immaterial,
          since the length of 15 is the smallest in the network and will have priority over any other vertex. At this
          point,
          the path consists of 1-2, 2-4, 4-6, and 4-5. The next step connects 5 to 7 (18.03), then 7 to 8 (18.03), and 8
          to 9 (15). The only
          remaining unconnected point is 3, which is linked to 5 (29.15). The resulting MST follows the red lines in
          Figure <a href="#fig:graph2">56</a>. Every point is visited and the total distance of the path is minimized.
        </p>
        <div class="figure" style="text-align: center"><span id="fig:graph2"></span>
          <img src="pics1b/22_db_points_example2.png" alt="Minimum spanning tree" width="50%" />
          <p class="caption">
            Figure 56: Minimum spanning tree
          </p>
        </div>
        <p><br></p>
      </div>
    </div>
    <div id="references" class="section level2 unnumbered" number="">
      <h2>References</h2>
      <div id="refs" class="references hanging-indent">
        <div id="ref-KesslerBattersby:19">
          <p>Kessler, Fritz C., and Sarah E. Battersby. 2019. <em>Working with Map Projections: A Guide to Their
              Selection</em>. Boca Raton, FL: CRC Press.</p>
        </div>
        <div id="ref-Snyder:93">
          <p>Snyder, John P. 1993. <em>Flattening the Earth: Two Thousand Years of Map Projections</em>. Chicago, IL:
            University of Chicago Press.</p>
        </div>
      </div>
    </div>
    <div class="footnotes">
      <hr />
      <ol>
        <li id="fn1">
          <p>University of Chicago, Center for Spatial Data Science – <a href="mailto:anselin@uchicago.edu"
              class="email">anselin@uchicago.edu</a><a href="#fnref1" class="footnote-back">↩︎</a></p>
        </li>
        <li id="fn2">
          <p>For more details on the fundamentals behind the UTM projection, see, for example,
            the <a href="https://gisgeography.com/utm-universal-transverse-mercator-projection/">GISGeography
              site</a>.<a href="#fnref2" class="footnote-back">↩︎</a></p>
        </li>
        <li id="fn3">
          <p>The
            fractional values for <strong>HC60</strong> follow from the fact that the homicide counts are averages over
            three years.<a href="#fnref3" class="footnote-back">↩︎</a></p>
        </li>
        <li id="fn4">
          <p>Connectivity graphs
            are discussed in more detail in the chapters dealing with spatial weights.<a href="#fnref4"
              class="footnote-back">↩︎</a></p>
        </li>
      </ol>
    </div>

    <footer class="site-footer">
      <span class="site-footer-owner"><a href="https://github.com/lixun910/geoda">GeoDa</a> is maintained by <a
          href="#">lixun910</a>.</span>
      <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>
        using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a
          href="https://twitter.com/jasonlong">Jason Long</a>.</span>
    </footer>

  </section>


  <!-- code folding -->


  <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>

</body>

</html>