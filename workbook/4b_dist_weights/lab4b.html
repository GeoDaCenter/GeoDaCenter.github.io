<!DOCTYPE html>

<html>

<head>

  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="author" content="Luc Anselin" />


  <title>Distance-Band Spatial Weights</title>

  <script src="lab4b_files/header-attrs-2.3/header-attrs.js"></script>
  <link href="lab4b_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
  <script src="lab4b_files/highlightjs-9.12.0/highlight.js"></script>
  <title>GeoDa on Github</title>

  <style>
    * {
      margin: 0;
      padding: 0;
    }

    .shadowfilter {
      -webkit-filter: drop-shadow(12px 12px 7px rgba(0, 0, 0, 0.5));
      filter: url(shadow.svg#drop-shadow);
    }

    .intro1 {
      margin-left: -45px;
    }
  </style>
  <link rel="stylesheet" type="text/css" href="https://geodacenter.github.io/stylesheets/normalize.css" media="screen">
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="https://geodacenter.github.io/stylesheets/stylesheet.css" media="screen">
  <link rel="stylesheet" type="text/css" href="https://geodacenter.github.io/stylesheets/github-light.css"
    media="screen">
  <link rel="stylesheet" href="https://geodacenter.github.io/stylesheets/simple-slideshow-styles.css">
  <style>
    ul {
      padding-left: 30px;
    }

    figcaption {
      top: .70em;
      left: .35em;
      bottom: auto !important;
      right: auto !important;
    }
  </style>

  <style>
    h1 {
      text-align: center;
    }

    h3.subtitle {
      text-align: center;
    }

    h4.author {
      text-align: center;
    }

    h4.date {
      text-align: center;
    }

    p.caption {
      font-size: 12px;
    }
  </style>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LC0QJ53WFS"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-LC0QJ53WFS');
  </script>
  <!-- End Google tag -->

  <style type="text/css">
    code {
      white-space: pre;
    }
  </style>
  <script type="text/javascript">
    if (window.hljs) {
      hljs.configure({ languages: [] });
      hljs.initHighlightingOnLoad();
      if (document.readyState && document.readyState === "complete") {
        window.setTimeout(function () { hljs.initHighlighting(); }, 0);
      }
    }
  </script>








</head>

<body>


  <section class="main-content">


    <h1 class="title toc-ignore">Distance-Band Spatial Weights</h1>
    <h4 class="author">Luc Anselin<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></h4>
    <h4 class="date">10/08/2020 (updated)</h4>


    <div id="TOC">
      <ul>
        <li><a href="#introduction">Introduction</a>
          <ul>
            <li><a href="#objectives">Objectives</a>
              <ul>
                <li><a href="#geoda-functions-covered">GeoDa functions covered</a></li>
              </ul>
            </li>
            <li><a href="#preliminaries">Preliminaries</a>
              <ul>
                <li><a href="#customizing-the-point-map">Customizing the point map</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#distance-band-weights">Distance-Band Weights</a>
          <ul>
            <li><a href="#concepts">Concepts</a>
              <ul>
                <li><a href="#distance-metrics">Distance metrics</a></li>
                <li><a href="#great-circle-distance">Great circle distance</a></li>
                <li><a href="#distance-band-weights-1">Distance-band weights</a></li>
              </ul>
            </li>
            <li><a href="#creating-distance-band-weights">Creating distance-band weights</a></li>
            <li><a href="#gwt-file">GWT file</a></li>
            <li><a href="#weights-characteristics">Weights characteristics</a>
              <ul>
                <li><a href="#connectivity-histogram">Connectivity histogram</a></li>
                <li><a href="#finding-the-locations-separated-by-the-max-min-distance">Finding the locations separated
                    by the max-min distance</a></li>
                <li><a href="#finding-the-most-connected-observations">Finding the most connected observations</a></li>
                <li><a href="#connectivity-graph">Connectivity graph</a></li>
              </ul>
            </li>
            <li><a href="#isolates">Isolates</a>
              <ul>
                <li><a href="#isolates-in-the-connectivity-histogram">Isolates in the connectivity histogram</a></li>
                <li><a href="#isolates-in-the-connectivity-graph">Isolates in the connectivity graph</a></li>
                <li><a href="#how-to-deal-with-isolates">How to deal with isolates</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#k-nearest-neighbor-weights">K-Nearest Neighbor Weights</a>
          <ul>
            <li><a href="#concept">Concept</a></li>
            <li><a href="#creating-knn-weights">Creating KNN weights</a>
              <ul>
                <li><a href="#properties-of-knn-weights">Properties of KNN weights</a></li>
                <li><a href="#knn-and-distance">KNN and distance</a></li>
                <li><a href="#making-knn-weights-symmetric">Making KNN weights symmetric</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#generalizing-the-concept-of-contiguity">Generalizing the Concept of Contiguity</a>
          <ul>
            <li><a href="#contiguity-based-weights-for-points">Contiguity-based weights for points</a>
              <ul>
                <li><a href="#thiessen-polygons">Thiessen polygons</a></li>
                <li><a href="#contiguity-weights-for-thiessen-polygons">Contiguity weights for Thiessen polygons</a>
                </li>
              </ul>
            </li>
            <li><a href="#distance-based-weights-for-polygons">Distance-based weights for polygons</a>
              <ul>
                <li><a href="#distance-metric-warning">Distance metric warning</a></li>
                <li><a href="#great-circle-distance-1">Great circle distance</a></li>
                <li><a href="#distance-weight-properties-for-polygons">Distance weight properties for polygons</a></li>
              </ul>
            </li>
            <li><a href="#general-distance-matrix">General distance matrix</a></li>
          </ul>
        </li>
        <li><a href="#manipulating-weights-matrices">Manipulating Weights Matrices</a>
          <ul>
            <li><a href="#intersection">Intersection</a></li>
            <li><a href="#union">Union</a></li>
          </ul>
        </li>
        <li><a href="#references">References</a></li>
      </ul>
    </div>

    <p><br></p>
    <div id="introduction" class="section level2 unnumbered" number="">
      <h2>Introduction</h2>
      <p>In this Chapter, we will continue to deal with the spatial weights functionality in <code>GeoDa</code>,
        but now we will focus on weights that use the notion of distance. Intrinsically, this
        is most appropriate for point layers, but we will see that it can readily be
        generalized to polygons as well.</p>
      <p>We will initially use a data set with point locations of house sales for Cleveland, OH,
        but later return to our U.S. county Homicides data to illustrate the polygon case.</p>
      <p>We will compute the distance between points to create distance-band weights, as well as k-nearest neighbor
        weights. We will examine the weights characteristics and pay particular attention to the issue of neighborless
        locations, or <em>isolates</em>. We also
        consider generalizing the
        concept of contiguity to points (using Thiessen polygons), and the notion of distance-based weights for polygons
        (using their centroids to compute the distances). In addition, we consider the use of the weights functionality
        to create a general distance or dissimularity matrix derived from multiple variables. Finally, we consider some
        ways to manipulate different spatial weights matrices, such as intersection and union.</p>
      <div id="objectives" class="section level3 unnumbered" number="">
        <h3>Objectives</h3>
        <ul>
          <li>
            <p>Construct distance band spatial weights</p>
          </li>
          <li>
            <p>Understand the contents of a gwt weights file</p>
          </li>
          <li>
            <p>Assess the characteristics of distance-based weights</p>
          </li>
          <li>
            <p>Assess the effect of the max-min distance cut-off</p>
          </li>
          <li>
            <p>Identify isolates</p>
          </li>
          <li>
            <p>Construct k-nearest neighbor spatial weights</p>
          </li>
          <li>
            <p>Making a k-nearest neighbor weights matrix symmetric</p>
          </li>
          <li>
            <p>Construct contiguity weights for points and distance weights for polygons</p>
          </li>
          <li>
            <p>Understand the use of great circle distance</p>
          </li>
          <li>
            <p>Create a general dissimilarity matrix based on multiattribute distance</p>
          </li>
          <li>
            <p>Investigate commonalities among spatial weights (intersection and union)</p>
          </li>
        </ul>
        <div id="geoda-functions-covered" class="section level4 unnumbered" number="">
          <h4>GeoDa functions covered</h4>
          <ul>
            <li>Legend &gt; set color for category</li>
            <li>Preferences &gt; Use classic yellow cross-hatching to highlight selection in maps</li>
            <li>Weight File Creation dialog
              <ul>
                <li>distance-band weights</li>
                <li>k-nearest neighbor weights</li>
                <li>great circle distance option</li>
              </ul>
            </li>
            <li>Weights Manager
              <ul>
                <li>Connectivity Histogram, Map and Graph</li>
                <li>Intersection, Union</li>
                <li>Make symmetric</li>
              </ul>
            </li>
          </ul>
          <p><br></p>
        </div>
      </div>
      <div id="preliminaries" class="section level3 unnumbered" number="">
        <h3>Preliminaries</h3>
        <p>To begin, we will use a data set that contains the location and sales price of 205 homes in a core area of
          Cleveland, OH for the fourth quarter of 2015.
          The data set is included in the <a href="https://geodacenter.github.io/data-and-lab/">GeoDa Center data set
            collection</a>:</p>
        <ul>
          <li><a href="https://geodacenter.github.io/data-and-lab//clev_sls_154_core/">cleveland</a>: sample of home
            sales in Cleveland, OH for 2015</li>
        </ul>
        <p><br></p>
        <p>After downloading, this yields a folder with four shape files with file name
          <strong>clev_sls_154_core</strong> and
          the usual four file extensions (shp, shx, dbf and prj).</p>
        <p>For polygon-based distance weights, we will continue to use the <strong>ncovr</strong> data set that is comes
          built-in with <code>GeoDa</code> and is also
          contained in the <a href="https://geodacenter.github.io/data-and-lab/">GeoDa Center data set collection</a>.
        </p>
        <ul>
          <li><a href="https://geodacenter.github.io/data-and-lab/ncovr/">ncovr</a>: homicide and socio-economic data
            for 3085 U.S. counties</li>
        </ul>
        <p><br></p>
        <div id="customizing-the-point-map" class="section level4 unnumbered" number="">
          <h4>Customizing the point map</h4>
          <p>We get started by clearing the previous project and dropping the file
            <strong>clev_sls_154_core.shp</strong> into the <strong>Drop files here</strong> rectangle of the connect to
            data source dialog. This yields a themeless base map.</p>
          <p>We make three minor modifications to improve the visibility
            of the points and to put them into context in the city. First, we change the color of the points themselves
            (actually, drawn as tiny circles). This is one of the options in the legend panel of the map. We need to
            right click on the green box to the left
            of <strong>(205)</strong> in the themeless base map, and set <strong>Fill Color for Category</strong> to
            white and <strong>Outline Color for Category</strong> to black.</p>
          <p>Next, we change the way selected and unselected points are
            displayed. The default is to use transparency to distinguish them, but for points this
            often does not provide a clear distinction, in the sense that the unselected points
            may be hard to see. Instead, we go back to the <em>old</em> way of highlighting selected observations
            in <code>GeoDa</code>, which is to use a different color.</p>
          <p>We set this option in the <strong>System</strong> tab of the <strong>GeoDa Preferences Setup</strong>. The
            first item under <strong>Maps</strong> pertains to the way in which map selections are highlighted. The
            default is to have the check box off, but we change that so that the box is checked, as shown in Figure <a
              href="#fig:color1">1</a>.</p>
          <div class="figure" style="text-align: center"><span id="fig:color1"></span>
            <img src="pics4b/0_374_highlightoption.png" alt="GeoDa selection preferences" width="60%" />
            <p class="caption">
              Figure 1: GeoDa selection preferences
            </p>
          </div>
          <p>Finally, we add a base map, using the <strong>ESRI &gt; WorldStreetMap</strong> option. The transparency
            may need some adjustment to
            make the points easier to see (use <strong>Change Map Transparency</strong> from the base map icon options
            menu). The final
            result is as in Figure <a href="#fig:clevebase">2</a>.</p>
          <div class="figure" style="text-align: center"><span id="fig:clevebase"></span>
            <img src="pics4b/11_cleveland_points.png" alt="Cleveland home sales base map" width="60%" />
            <p class="caption">
              Figure 2: Cleveland home sales base map
            </p>
          </div>
        </div>
      </div>
    </div>
    <div id="distance-band-weights" class="section level2 unnumbered" number="">
      <h2>Distance-Band Weights</h2>
      <div id="concepts" class="section level3 unnumbered" number="">
        <h3>Concepts</h3>
        <div id="distance-metrics" class="section level4 unnumbered" number="">
          <h4>Distance metrics</h4>
          <p>The core input into the determination of a neighbor relation for distance-based
            spatial weights is a formal measure of distance, or a distance <em>metric</em>.
            The most familiar case is the <em>Euclidean</em> or straight line
            distance, <span class="math inline">\(d_{ij}\)</span>, as the crow flies:
            <span class="math display">\[\begin{equation*}
              d_{ij} = \sqrt{(x_{i} - x_{j})^{2} + (y_{i} - y_{j})^{2}},
              \end{equation*}\]</span>
            for two points <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, with
            respective coordinates <span class="math inline">\((x_{i},y_{i})\)</span> and
            <span class="math inline">\((x_{j},y_{j})\)</span>.
          </p>
          <p>An alternative to Euclidean distance that is sometimes preferred because it
            lessens the influence of outliers is the so-called <em>Manhattan</em> distance. This metric
            only considers movement along the east-west and north-south directions, as in the
            city blocks of Manhattan. Formally, this metric is:
            <span class="math display">\[\begin{equation*}
              d_{ij}^m = | x_{i} - x_{j}| + | y_{i} - y_{j}|.
              \end{equation*}\]</span>
          </p>
        </div>
        <div id="great-circle-distance" class="section level4 unnumbered" number="">
          <h4>Great circle distance</h4>
          <p>Euclidean inter-point distances
            are only meaningful when the coordinates are recorded on
            a plane, i.e., for projected points.</p>
          <p>In practice,
            one often works with unprojected points, expressed as
            degrees of latitude and longitude, in which case using a straight
            line distance measure is inappropriate, since it ignores the curvature
            of the earth. This is especially the case for longer distances, such
            as from the East Coast to the West Coast in the U.S.</p>
          <p>The proper distance measure in this case is the so-called
            <em>arc distance</em> or <em>great circle distance</em>. This
            takes the latitude and longitude in decimal degrees as input
            into a conversion formula.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> Decimal degrees
            are obtained
            from the degree-minute-second value as degrees +
            minutes/60 + seconds/3600.
          </p>
          <p>The latitude and longitude in
            decimal degrees are converted into radians as:
            <span class="math display">\[\begin{eqnarray*}
              \mbox{Lat}_r &amp;=&amp; (\mbox{Lat}_d - 90) * \pi/180\\
              \mbox{Lon}_r &amp;=&amp; \mbox{Lon}_d * \pi/180,
              \end{eqnarray*}\]</span>
            where the subscripts <span class="math inline">\(d\)</span> and <span class="math inline">\(r\)</span> refer
            respectively to decimal
            degrees and radians, and <span class="math inline">\(\pi = 3.14159 \dots\)</span>.
            With <span class="math inline">\(\Delta \mbox{Lon} = \mbox{Lon}_{r(j)} - \mbox{Lon}_{r(i)}\)</span>, the
            expression for the arc distance is:
            <span class="math display">\[\begin{eqnarray*}
              d_{ij} &amp;=&amp; \mbox{R} * \arccos [ \cos ( \Delta \mbox{Lon} )
              * \sin \mbox{Lat}_{r(i)} *
              \sin \mbox{Lat}_{r(j)} )\\
              &amp;&amp;+ \cos \mbox{Lat}_{r(i)} * \cos \mbox{Lat}_{r(j)} ],
              \end{eqnarray*}\]</span>
            or, equivalently:
            <span class="math display">\[\begin{eqnarray*}
              d_{ij} &amp;=&amp; \mbox{R} * \arccos [ \cos ( \Delta \mbox{Lon} )
              * \cos \mbox{Lat}_{r(i)} *
              \cos \mbox{Lat}_{r(j)} )\\
              &amp;&amp;+ \sin \mbox{Lat}_{r(i)} * \sin \mbox{Lat}_{r(j)} ],
              \end{eqnarray*}\]</span>
            where R is the radius of the earth. In <code>GeoDa</code>, the arc distance is obtained in
            miles with R = 3959, and in kilometers with R = 6371.
          </p>
          <p>These
            calculated distance values are only approximate, since the radius
            of the earth is taken at the equator. A more precise measure would
            take into account the actual latitude at which the distance
            is measured. In addition, the earth’s shape is much
            more complex than a sphere, but the approximation serves our purposes.</p>
        </div>
        <div id="distance-band-weights-1" class="section level4 unnumbered" number="">
          <h4>Distance-band weights</h4>
          <p>The most straightforward spatial weights matrix constructed from a
            distance measure is obtained when <span class="math inline">\(i\)</span> and <span
              class="math inline">\(j\)</span> are considered neighbors whenever <span class="math inline">\(j\)</span>
            falls within a critical <em>distance band</em> from <span class="math inline">\(i\)</span>. More precisely,
            <span class="math inline">\(w_{ij} = 1\)</span>
            when <span class="math inline">\(d_{ij} \le \delta\)</span>, and <span class="math inline">\(w_{ij} =
              0\)</span> otherwise, where <span class="math inline">\(\delta\)</span> is
            a preset critical distance cutoff.</p>
          <p>In order to avoid isolates (islands) that would result from too
            stringent a critical distance, the distance must be chosen such
            that each
            location has at least one neighbor. Such a distance conforms
            to a <em>max-min</em> criterion, i.e., it is the largest of the
            nearest neighbor distances.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
          <p>In practice, the max-min criterion often leads to too many neighbors
            for locations that are somewhat clustered, since the critical
            distance is determined by the points that are furthest apart.
            This problem
            frequently occurs
            when the density of the points is uneven across
            the data set, such as when some of the points are clustered
            and others more spread out. We revisit this problem in the illustrations
            below.</p>
          <p>Further technical details on distance-based spatial weights are contained Chapters 3 and 4 of <span
              class="citation">Anselin and Rey (<a href="#ref-AnselinRey:14" role="doc-biblioref">2014</a>)</span>,
            although the software illustrations are for an earlier <code>GeoDa</code> interface design.</p>
        </div>
      </div>
      <div id="creating-distance-band-weights" class="section level3 unnumbered" number="">
        <h3>Creating distance-band weights</h3>
        <p>As we did for contiguity weights, we invoke the <strong>Weights Manager</strong> and click on the
          <strong>Create</strong> button to get the process started. In the <strong>Weights File Creation</strong>
          interface, after specifying the ID variable (<strong>unique_id</strong>), we focus on the right-most button,
          <strong>Distance Weight</strong>. This generates the dialog for the two types of distance metrics, either
          computed from
          <strong>Geometric centroids</strong> (the default), or computed as multi-attribute distance for a series of
          <strong>Variables</strong>. For now,
          we focus on the use of coordinates.
        </p>
        <p>In addition to the two types of variables, there are three methods:
          <strong>Distance band</strong>, <strong>K-Nearest neighbors</strong>, and <strong>Kernel</strong>.
          In this Chapter, we focus on the first two options.
        </p>
        <p>Distance band weights are initiated by selecting the <strong>Distance band</strong> button in the interface,
          as
          shown in Figure <a href="#fig:distanceband">3</a>. This is also the default option. The max-min distance
          (largest nearest neighbor distance) is given in the box next to
          <strong>Specify bandwidth</strong>, in units appropriate for the projection used. In our example, the distance
          of 3598 is expressed
          in feet.
        </p>
        <div class="figure" style="text-align: center"><span id="fig:distanceband"></span>
          <img src="pics4b/11_distance_weight_dialog.png" alt="Distance band default setting" width="40%" />
          <p class="caption">
            Figure 3: Distance band default setting
          </p>
        </div>
        <p>Note the importance of the <strong>Distance metric</strong>, highlighted in Figure <a
            href="#fig:distanceband">3</a>. Since our data is projected, it is appropriate to use
          <strong>Euclidean</strong> (straight line) distance. However, many data sets come in simple
          latitude-longitude, for which a great circle distance (or arc distance) must be used instead. We will revisit
          this shortly.</p>
        <p>The critical distance for our point data is about 3598 feet, or roughly 0.7 miles. This is the distance that
          ensures that each point (house sale) has at least one neighbor. After clicking on the <strong>Create</strong>
          button and specifying a file name, such as <strong>clev_sls_154_cored_d</strong>
          (the GWT file extension is added automatically), the new weights and their
          summary properties are listed in the <strong>Weights Manager</strong>, as in Figure <a
            href="#fig:dweights1">4</a>.</p>
        <div class="figure" style="text-align: center"><span id="fig:dweights1"></span>
          <img src="pics4b/11_weights_manager_dist.png" alt="Distance weights in weight manager" width="30%" />
          <p class="caption">
            Figure 4: Distance weights in weight manager
          </p>
        </div>
        <p>An important aspect of the metadata in the weights manager is the <strong>threshold value</strong>. This
          information will also be included in any <strong>Project File</strong> that is saved. This is the only
          reliable way to remember which distance cut-off was used for the distance bands in the weights.</p>
      </div>
      <div id="gwt-file" class="section level3 unnumbered" number="">
        <h3>GWT file</h3>
        <p>Distance-based weights are saved in files with a <strong>GWT</strong> file extension. This format,
          illustrated in Figure <a href="#fig:gwtformat">5</a>, is slightly different from the GAL format used for
          contiguity weights. It was first introduced in <code>SpaceStat</code> in 1995, and later adopted by
          <code>R</code> <code>spdep</code> and other software packages. The header line is the same as for GAL files,
          but each pair of neighbors is listed, with the ID of the observation, the ID of its neighbor and the distance
          that separates them. This distance is currently only included for informational purposes, since
          <code>GeoDa</code> <strong>does not use the actual distance value in any statistical operations</strong>
          (spatial weights are also row-standardized by default).</p>
        <div class="figure" style="text-align: center"><span id="fig:gwtformat"></span>
          <img src="pics4b/1_gwtfile.png" alt="GWT file contents" width="30%" />
          <p class="caption">
            Figure 5: GWT file contents
          </p>
        </div>
      </div>
      <div id="weights-characteristics" class="section level3 unnumbered" number="">
        <h3>Weights characteristics</h3>
        <p>In the same way as for contiguity weights, we can assess the characteristics of
          distance-based weights by means of the <strong>Connectivity Histogram</strong>, the <strong>Connectivity
            Map</strong>, and the <strong>Connectivity Graph</strong>, available through the buttons at the bottom of
          the weights manager.</p>
        <div id="connectivity-histogram" class="section level4 unnumbered" number="">
          <h4>Connectivity histogram</h4>
          <p>The shape of the connectivity histogram for distance-band weights is typically very different from that of
            contiguity-based weights (as in any histogram, we can bring up descriptive statistics through the
            <strong>View &gt; Display Statistics</strong> option). As illustrated in Figure <a
              href="#fig:disthistogram">6</a>, we see a much larger range in the number of neighbors, as well as
            extremes, with some observations having only one neighbor, and others having 32.
          </p>
          <div class="figure" style="text-align: center"><span id="fig:disthistogram"></span>
            <img src="pics4b/1_clev_d_histogram.png" alt="Connectivity histogram -- default distance band"
              width="40%" />
            <p class="caption">
              Figure 6: Connectivity histogram – default distance band
            </p>
          </div>
          <p>We also observe the descriptive statistics in the property list shown in Figure <a
              href="#fig:dweights1">4</a>.
            Compared to contiguity weights, the mean (12.64) and median (13.00) number of neighbors are much
            higher, and the matrix is also much denser (% non-zero = 6.17%).</p>
          <p>The range in the number of neighbors is directly related to the spatial distribution of the points.
            Locations that are somewhat isolated will drive the determination of the largest nearest neighbor cut-off
            point (their nearest neighbor distance will be large), whereas dense clusters of locations will encompass
            many neighbors using this large cut-off distance.</p>
        </div>
        <div id="finding-the-locations-separated-by-the-max-min-distance" class="section level4 unnumbered" number="">
          <h4>Finding the locations separated by the max-min distance</h4>
          <p>In the Cleveland example, we can examine the GWT file to find the observation pair separated by the
            critical distance cut-off (3598). As shown in Figure <a href="#fig:maxdist">7</a>, this turns out to be the
            observation pair with unique_id 11359 and 10014.</p>
          <div class="figure" style="text-align: center"><span id="fig:maxdist"></span>
            <img src="pics4b/1_cutoff_distance.png" alt="Cut off distance in GWT file" width="20%" />
            <p class="caption">
              Figure 7: Cut off distance in GWT file
            </p>
          </div>
          <p>In the Table, a selection of observation with unique_id 11359 will result in the corresponding
            location to be highlighted in red in the
            point map, as indicated with the pointer in
            Figure <a href="#fig:maxminlocation">8</a>.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>
          </p>
          <div class="figure" style="text-align: center"><span id="fig:maxminlocation"></span>
            <img src="pics4b/11_maxmin_point.png" alt="Selected max-min location" width="60%" />
            <p class="caption">
              Figure 8: Selected max-min location
            </p>
          </div>
          <p>We now open the <strong>Connectivity Map</strong>, shown in Figure <a href="#fig:distconnmap">9</a>. Since
            this map is a regular themeless map, we can customize
            it in the same way as the original point map by adding a base layer (ESRI &gt; WorldStreetMap). As the
            current selection,
            the point with <strong>unique_id</strong> 11359 will be highlighted in red. With the pointer
            hovering over the selected point, the status bar of the connectivity map
            will show the selected observation (11359) and its one neighbor (10114) highlighted as in
            Figure <a href="#fig:distconnmap">9</a>.</p>
          <div class="figure" style="text-align: center"><span id="fig:distconnmap"></span>
            <img src="pics4b/11_maxmin_neighbor.png" alt="Selected max-min location in Connectivity Map" width="60%" />
            <p class="caption">
              Figure 9: Selected max-min location in Connectivity Map
            </p>
          </div>
        </div>
        <div id="finding-the-most-connected-observations" class="section level4 unnumbered" number="">
          <h4>Finding the most connected observations</h4>
          <p>We can examine the effect of the large distance cut-off on more densely distributed point locations. For
            example, selecting the right-most bar in the <strong>Connectivity Histogram</strong> will highlight the two
            most connected observations in the map. The connectivity histogram shows
            that these have 32 neighbors. The two points are highlighted in red in the map in Figure <a
              href="#fig:mostconnected">10</a>.</p>
          <div class="figure" style="text-align: center"><span id="fig:mostconnected"></span>
            <img src="pics4b/11_densest_points.png" alt="Most connected observations" width="60%" />
            <p class="caption">
              Figure 10: Most connected observations
            </p>
          </div>
          <p>As expected, the two points in question are in the center of a dense cluster of sales transactions.
            Through linking, they are also selected in the <strong>Connectivity Map</strong>. We can find their
            unique_id
            values from the table (<strong>Move Selected to Top</strong>). For example, for the observation with
            unique_id=19785, we see in the connectivity map that this point has 32 neighbors, highlighted as
            black circles in Figure <a href="#fig:mostconnectedneighbors">11</a>.</p>
          <div class="figure" style="text-align: center"><span id="fig:mostconnectedneighbors"></span>
            <img src="pics4b/11_densest_neighbors.png" alt="Most connected observations in connectivity map"
              width="60%" />
            <p class="caption">
              Figure 11: Most connected observations in connectivity map
            </p>
          </div>
          <p>The unequal distribution of the neighbor cardinality in distance-band weights is often an undesirable
            feature. Therefore, when the spatial distribution of the points is highly uneven, distance-band weights
            should be avoided, since they could provide misleading impressions of (local) spatial autocorrelation. We
            examine some alternatives below.</p>
        </div>
        <div id="connectivity-graph" class="section level4 unnumbered" number="">
          <h4>Connectivity graph</h4>
          <p>The properties of the distance band weights can be further investigated by means of the
            <strong>Connectivity Graph</strong>. As before, this is invoked through the right-most button at
            the bottom of the weights manager.
          </p>
          <p>The pattern shown in Figure <a href="#fig:dconngraph">12</a> highlights how the connectivity divides the
            points into
            two interconnected subgraphs and two pairs of points. The different sub-networks have no connection between
            them. We can also identify a few locations that are only connected with their nearest neighbor, but not with
            any other locations.</p>
          <div class="figure" style="text-align: center"><span id="fig:dconngraph"></span>
            <img src="pics4b/11_dist_conn_graph.png" alt="Connectivity graph for distance band weights" width="60%" />
            <p class="caption">
              Figure 12: Connectivity graph for distance band weights
            </p>
          </div>
        </div>
      </div>
      <div id="isolates" class="section level3 unnumbered" number="">
        <h3>Isolates</h3>
        <p>So far, we have used the default cut-off value for the distance band. However, the dialog is flexible enough
          that we can type in any value for the cut-off, or use the moveable button to drag to any value larger than the
          minimum. Sometimes, theoretical or policy considerations suggest a specific value for the cut-off that may be
          smaller than the max-min distance.</p>
        <p>For example, say we want to use 1500 ft. as the distance band. After typing in that value in the dialog,
          shown in Figure <a href="#fig:d1500">13</a>, we proceed in the usual way to create the weights.</p>
        <div class="figure" style="text-align: center"><span id="fig:d1500"></span>
          <img src="pics4b/1_clev_d1500.png" alt="Distance band set to 1500" width="30%" />
          <p class="caption">
            Figure 13: Distance band set to 1500
          </p>
        </div>
        <p>However, a warning appears, as in Figure <a href="#fig:distwarning">14</a>, pointing out that the specified
          cut-off value is smaller than the
          max-min distance needed to ensure that each observation has at least one neighbor.</p>
        <div class="figure" style="text-align: center"><span id="fig:distwarning"></span>
          <img src="pics4b/1_365_distancewarning.png" alt="Isolates warning message" width="35%" />
          <p class="caption">
            Figure 14: Isolates warning message
          </p>
        </div>
        <p>If we proceed and click <strong>Yes</strong> in the dialog, the properties of the new weights are listed in
          the weight manager, as in Figure <a href="#fig:propertiesd1500">15</a>. This includes the <strong>threshold
            value</strong> of 1500,
          but also shows a much sparser distribution, with <strong>%non-zero</strong> as 1.48% (compared to 6.17% for
          the
          default). In addition, the minimum number of neighbors is indicated to be <strong>0</strong>. In other words,
          one of more observations do not have neighbors when a distance band of 1500 feet is used.</p>
        <div class="figure" style="text-align: center"><span id="fig:propertiesd1500"></span>
          <img src="pics4b/11_d1500.png" alt="Distance threshold 1500 properties" width="30%" />
          <p class="caption">
            Figure 15: Distance threshold 1500 properties
          </p>
        </div>
        <div id="isolates-in-the-connectivity-histogram" class="section level4 unnumbered" number="">
          <h4>Isolates in the connectivity histogram</h4>
          <p>The connectivity histogram shown in Figure <a href="#fig:isolatesconnhist">16</a> reveals a much more
            compact distribution of
            neighbor cardinality (compared to the max-min criterion). However, it also suggests the existence of 24
            isolates, i.e., observations without neighbors. This is given as a warning at the top of the histogram
            (highlighted in red in the figure), but can also be seen by hovering the pointer over the
            first bin. The status bar reveals that the range 0-1 has 24 observations.</p>
          <div class="figure" style="text-align: center"><span id="fig:isolatesconnhist"></span>
            <img src="pics4b/1_clev_isolates2.png" alt="Isolates in connectivity histogram" width="40%" />
            <p class="caption">
              Figure 16: Isolates in connectivity histogram
            </p>
          </div>
          <p>When selecting the left-most bar in the histogram, we can locate the isolated points in the map,
            as in Figure <a href="#fig:isolatesinmap">17</a> (the red points are the selected observations). The
            selected points are indeed locations that are far away from the other points (more than 1500 feet).</p>
          <div class="figure" style="text-align: center"><span id="fig:isolatesinmap"></span>
            <img src="pics4b/11_isolates.png" alt="Isolates in point map" width="60%" />
            <p class="caption">
              Figure 17: Isolates in point map
            </p>
          </div>
        </div>
        <div id="isolates-in-the-connectivity-graph" class="section level4 unnumbered" number="">
          <h4>Isolates in the connectivity graph</h4>
          <p>The most dramatic visualization of the isolates is given by the <strong>Connectivity Graph</strong>, shown
            in
            Figure <a href="#fig:d1500conngraph">18</a>. The 24 points without an edge in the graph to another point are
            easily
            identified.</p>
          <div class="figure" style="text-align: center"><span id="fig:d1500conngraph"></span>
            <img src="pics4b/11_conn_isolates.png" alt="Connectivity graph for distance band set to 1500" width="60%" />
            <p class="caption">
              Figure 18: Connectivity graph for distance band set to 1500
            </p>
          </div>
        </div>
        <div id="how-to-deal-with-isolates" class="section level4 unnumbered" number="">
          <h4>How to deal with isolates</h4>
          <p>Since the isolated observations are not included in the spatial weights (in effect, the corresponding row
            in the spatial weights matrix consists of zeros), they are not accounted for in any spatial analysis, such
            as tests for spatial autocorrelation, or spatial regression. For all practical purposes, they should be
            removed from such analysis. However, they are fine
            to be included in a traditional <em>non-spatial</em> data analysis.</p>
          <p>Ignoring isolates may cause problems in the calculation of spatially lagged variables, or measures of local
            spatial autocorrelation. By construction, the spatially
            lagged variable will be zero, which may suggest spurious correlations.</p>
          <p>Alternatives where isolates are avoided by design are the K-nearest neighbor weights and
            contiguity weights constructed from the Thiessen polygons for the points. They are discussed next.</p>
        </div>
      </div>
    </div>
    <div id="k-nearest-neighbor-weights" class="section level2 unnumbered" number="">
      <h2>K-Nearest Neighbor Weights</h2>
      <div id="concept" class="section level3 unnumbered" number="">
        <h3>Concept</h3>
        <p>As mentioned, an alternative type of distance-based spatial weights that avoids the problem
          of isolates are <span class="math inline">\(k\)</span>-nearest neighbor weights. In contrast
          to the distance band, this is not a symmetric relation. The fact that B is the nearest
          neighbor to A does not imply that A is the nearest neighbor to B. There may be another point
          C that is actually closer to B than A. This asymmetry can cause problems in analyses that
          depend on the instrinsic symmetry of the weights (e.g., some algorithms to estimate spatial
          regression models). We revisit this below.</p>
        <p>A potential issue with <span class="math inline">\(k\)</span>-nearest neighbor weights is the
          occurrence of ties, i.e., when more than one location <span class="math inline">\(j\)</span> has the
          same distance from <span class="math inline">\(i\)</span>. A number of solutions exist to break
          the tie, from randomly selecting one of the <span class="math inline">\(k\)</span>-th order
          neighbors, to including all of them. In <code>GeoDa</code>,
          random selection is implemented.</p>
      </div>
      <div id="creating-knn-weights" class="section level3 unnumbered" number="">
        <h3>Creating KNN weights</h3>
        <p>KNN weights are computed by selecting the corresponding button in
          <strong>Distance Weight</strong> panel of the <strong>Weights File Creation</strong> interface. The value for
          the <strong>Number of neighbors</strong> (k) is specified in the box shown in Figure <a
            href="#fig:knn6">19</a>. The default is 4, but in our example, we have selected <strong>6</strong>.
        </p>
        <div class="figure" style="text-align: center"><span id="fig:knn6"></span>
          <img src="pics4b/11_knn_dialog.png" alt="K nearest neighbor weights" width="40%" />
          <p class="caption">
            Figure 19: K nearest neighbor weights
          </p>
        </div>
        <p>The weights (saved as the file <strong>clev_sls_154_core_k6</strong>) are added to the collection contained
          in the weights manager. In addition, all its properties are listed, as illustrated in Figure <a
            href="#fig:knnproperties">20</a>. Note
          that the properties now include the number of neighbors (instead of the distance threshold value,
          as is the case of distance-band weights). Also, <strong>symmetry</strong> is set to asymmetric, which is a
          fundamental difference with distance-band weights.</p>
        <div class="figure" style="text-align: center"><span id="fig:knnproperties"></span>
          <img src="pics4b/11_k6_summary.png" alt="KNN-6 weights properties" width="30%" />
          <p class="caption">
            Figure 20: KNN-6 weights properties
          </p>
        </div>
        <div id="properties-of-knn-weights" class="section level4 unnumbered" number="">
          <h4>Properties of KNN weights</h4>
          <p>The properties listed in the weights manager also include the mean and median number of
            neighbors, which of course equal k (in our example, they equal 6). The resulting weights matrix
            is much sparser than the distance-band weights (2.93% compared to 6.17%).</p>
          <p>Again, we can also use the connectivity histogram and the connectivity map to inspect the neighbor
            characteristics of the observations. However, in this case, the histogram doesn’t make much sense, since all
            observations have the same number of neighbors (by construction), as shown
            in Figure <a href="#fig:knnhist">21</a>.</p>
          <div class="figure" style="text-align: center"><span id="fig:knnhist"></span>
            <img src="pics4b/2_386_k6connectivity.png" alt="KNN-6 connectivity histogram" width="20%" />
            <p class="caption">
              Figure 21: KNN-6 connectivity histogram
            </p>
          </div>
          <p>In contrast, the connectivity graph, shown in Figure <a href="#fig:knngraph">22</a>, clearly demonstrates
            how each point is connected to six other points. In our example, this yields a fully connected
            graph instead of the collection of sub-graphs for the distance band.</p>
          <div class="figure" style="text-align: center"><span id="fig:knngraph"></span>
            <img src="pics4b/11_knn_conn_graph.png" alt="KNN-6 connectivity graph" width="60%" />
            <p class="caption">
              Figure 22: KNN-6 connectivity graph
            </p>
          </div>
        </div>
        <div id="knn-and-distance" class="section level4 unnumbered" number="">
          <h4>KNN and distance</h4>
          <p>One drawback of the k-nearest neighbor approach is that it ignores the distances involved. The first k
            neighbors are selected, irrespective of how near or how far they may be. This suggests a notion of distance
            decay that is not absolute, but relative, in the sense of intervening opportunities (e.g., you consider the
            two closest grocery stores, irrespective of how far they may be).</p>
          <p>This can be illustrated in the Cleveland example by selecting an observation in the western
            part of the map, where the house sales are densely distributed in space. With the pointer on
            one of the circles in the connectivity map, we distinguish six selected observations close by, as
            shown in Figure <a href="#fig:k6close">23</a>.</p>
          <div class="figure" style="text-align: center"><span id="fig:k6close"></span>
            <img src="pics4b/11_knn_dense.png" alt="KNN-6 close neighbors" width="40%" />
            <p class="caption">
              Figure 23: KNN-6 close neighbors
            </p>
          </div>
          <p>By contrast, if we move to the eastern part of the data set and similarly select an
            observation with the pointer, the six neighbors are much farther apart, as in Figure
            <a href="#fig:k6far">24</a>.
          </p>
          <div class="figure" style="text-align: center"><span id="fig:k6far"></span>
            <img src="pics4b/11_knn_sparse.png" alt="KNN-6 far neighbors" width="40%" />
            <p class="caption">
              Figure 24: KNN-6 far neighbors
            </p>
          </div>
          <p>This relative distance effect should be kept in mind before mechanically applying
            a k-nearest neighbor criterion.</p>
        </div>
        <div id="making-knn-weights-symmetric" class="section level4 unnumbered" number="">
          <h4>Making KNN weights symmetric</h4>
          <p>We pointed out that the knn weights are not guaranteed to be symmetric.
            One solution is to replace the original weights matrix <span class="math inline">\(\mathbf{W}\)</span> by
            <span class="math inline">\((\mathbf{W + W&#39;})/2\)</span>, which is symmetric by construction.<a
              href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> Each
            new weight is then <span class="math inline">\((w_{ij} + w_{ji})/2\)</span>. Another approach is to set both
            <span class="math inline">\(w_{ij}\)</span> and <span class="math inline">\(w_{ji}\)</span> to one whenever
            either one is non-zero. This is referred to as <em>mutual</em> symmetry. Since
            <code>GeoDa</code> doesn’t actually use the weights as such, the two approaches will yield the same result.
          </p>
          <p>The outcome is a GAL format weights matrix that contains the mutual contiguities.</p>
          <p>This transformation is invoked from the <strong>Weights Manager</strong>, by selecting the <strong>Make
              Symmetric</strong> button,
            as shown in Figure <a href="#fig:knnsymmetric">25</a>. Note how the transformation changed the average
            number of neighbors
            to 7.34, with a range from 6 to 12. As a result, the weights matrix is also slightly denser.</p>
          <div class="figure" style="text-align: center"><span id="fig:knnsymmetric"></span>
            <img src="pics4b/11_knn_symm.png" alt="KNN-6 weights transformed to symmetry" width="30%" />
            <p class="caption">
              Figure 25: KNN-6 weights transformed to symmetry
            </p>
          </div>
        </div>
      </div>
    </div>
    <div id="generalizing-the-concept-of-contiguity" class="section level2 unnumbered" number="">
      <h2>Generalizing the Concept of Contiguity</h2>
      <p>In <code>GeoDa</code>, the concept of contiguity can be generalized to point layers by converting
        the latter to a tessellation, specifically Thiessen polygons. Queen or rook contiguity
        weights can then be created for the polygons, in the usual way.</p>
      <p>Similarly, the concepts of distance-band weights and k-nearest neighbor weights can be
        generalized to polygon layers. The layers are represented by their central points and
        the standard distance computations are applied.</p>
      <p>These operations can be carried out explicitly, by actually creating a separate Thiessen polygon
        layer or centroid point layer, and subsequently loading it into <code>GeoDa</code> as a new project. However,
        this is not necessary, since
        the computations happen <em>under the hood</em>. In this way, it is possible
        to create contiguity weights for points or distance weights for polygons directly
        in the <strong>Weights File Creation</strong> dialog.</p>
      <p>We briefly consider these options.</p>
      <div id="contiguity-based-weights-for-points" class="section level3 unnumbered" number="">
        <h3>Contiguity-based weights for points</h3>
        <div id="thiessen-polygons" class="section level4 unnumbered" number="">
          <h4>Thiessen polygons</h4>
          <p>An alternative solution to deal with the problem of the uneven distribution of neighbor cardinality for
            distance-band weights is to compute a measure of contiguity. This is accomplished by turning the points into
            Thiessen polygons. These are also referred to as Voronoi diagrams or Delaunay triangulations, discussed at
            length in Chapter 2 on data wrangling.<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a></p>
          <p>To repeat, in general terms, a Thiessen polygon is a
            tessellation (a way to divide an area into regular subareas) that encloses all locations
            that are closer to the central point than to any other point. In economic geography, this
            is a (simplistic) notion of a market area, in the sense that all consumers in the polygon
            would patronize the seller located at the central point. The polygons are constructed
            by combining lines perpendicular at the midpoint of a line that connects a point to its nearest neighbors.
            From this, the most compact polygon is created.</p>
        </div>
        <div id="contiguity-weights-for-thiessen-polygons" class="section level4 unnumbered" number="">
          <h4>Contiguity weights for Thiessen polygons</h4>
          <p>When selecting rook or queen contiguity in the <strong>Contiguity Weight</strong> panel of the
            weights file creation dialog, the Thiessen polygons are constructed in the background
            and the contiguity criteria applied to them. For example, for our Cleveland point data, we can create
            a queen contiguity weights file in the standard way (e.g., as <strong>clev_sls_154_core_q</strong>). The
            file name subsequently shows up in the weights manager list, as
            illustrated in Figure <a href="#fig:queenptslist">26</a>.</p>
          <div class="figure" style="text-align: center"><span id="fig:queenptslist"></span>
            <img src="pics4b/11_thiessen_contig.png" alt="Queen contiguity for points" width="30%" />
            <p class="caption">
              Figure 26: Queen contiguity for points
            </p>
          </div>
          <p>The descriptive statistics in the properties list as well as the associated connectivity histogram
            illustrate why this approach may be a useful alternative to distance-band or k-nearest neighbor weights.
            In Figure <a href="#fig:queenptshist">27</a>, the connectivity histogram is shown with the statistics
            displayed.</p>
          <div class="figure" style="text-align: center"><span id="fig:queenptshist"></span>
            <img src="pics4b/3_392_point_q_histogram.png" alt="Points-based queen connectivity histogram "
              width="40%" />
            <p class="caption">
              Figure 27: Points-based queen connectivity histogram
            </p>
          </div>
          <p>The histogram represents a much more symmetric and compact distribution of the neighbor cardinalities, very
            similar to the typical shape of the histogram for first order contiguity between polygons. The median number
            of neighbors is 6 and the average 5.6, with a limited spread around these values. In many instances where
            the point distribution is highly uneven, this approach provides a useful compromise between the
            distance-band and the k-nearest neighbors.</p>
          <p>This is further illustrated by the connectivity graph for the queen contiguity, shown in
            Figure <a href="#fig:queenptsgraph">28</a>. The more balanced structure is reflected by the fully connected
            graph.</p>
          <div class="figure" style="text-align: center"><span id="fig:queenptsgraph"></span>
            <img src="pics4b/11_thiessen_conn_graph.png" alt="Connectivity graph for Thiessen queen contiguity"
              width="60%" />
            <p class="caption">
              Figure 28: Connectivity graph for Thiessen queen contiguity
            </p>
          </div>
          <p>Before moving on to the next option, we save the weights information in a <strong>Project File</strong>
            (e.g., <strong>clev_sls_154_core.gda</strong>), using <strong>File &gt; Save Project</strong>.</p>
        </div>
      </div>
      <div id="distance-based-weights-for-polygons" class="section level3 unnumbered" number="">
        <h3>Distance-based weights for polygons</h3>
        <p>To illustrate the application of distance-based weights to polygons, the current project
          needs to be cleared and the U.S. county homicide file (<strong>natregimes</strong>) loaded, either
          as a shape file (<strong>natregimes.shp</strong>, without any weights information), or from a
          previously created project
          file (<strong>natregimes.gda</strong>, with the weights information).</p>
        <p>As we have seen before, the polygon layer has a series of <strong>Shape Center</strong> options to
          add the centroid or mean center information to the data table, display those points on the
          map, or save them as a separate point layer.</p>
        <p>In order to create distance weights for polygons, such as the U.S. counties, there is no need
          to explicitly save or display the centroids. The calculation happens in the background, whenever a distance
          option is chosen in the weights file creation dialog.</p>
        <p>We proceed as usual, and select the <strong>Distance Weight</strong> option in the <strong>Weights File
            Creation</strong>
          dialog. With
          <strong>FIPSNO</strong> as the ID variable and <strong>Distance Band</strong> as the type of weight, the
          <strong>Specify bandwidth</strong>
          box will show a cut-off distance of 1.465776, as in Figure <a href="#fig:degreedistance">29</a>.
        </p>
        <div class="figure" style="text-align: center"><span id="fig:degreedistance"></span>
          <img src="pics4b/11_natregimes_dist.png" alt="Distance cut-off in decimal degrees" width="40%" />
          <p class="caption">
            Figure 29: Distance cut-off in decimal degrees
          </p>
        </div>
        <div id="distance-metric-warning" class="section level4 unnumbered" number="">
          <h4>Distance metric warning</h4>
          <p>The distance cut-off listed in the dialog is for the default setting of <strong>Euclidean
              Distance</strong>. For the U.S. counties, the geographic layer is provided in latitude-longitude
            decimal degrees (i.e., the coordinates are unprojected). Consequently, the use of a straight line Euclidean
            distance is inappropriate (at least, for larger distances).</p>
          <p>If we proceed anyway, a warning will be generated that the coordinates specified are not projected, as
            shown in
            Figure <a href="#fig:distancewarning">30</a>. Note that this warning only works if the projection
            information is included with
            the geographical layer. In our example, the <strong>prj</strong> file specifies that the coordinates are in
            decimal degrees,
            hence the warning.</p>
          <div class="figure" style="text-align: center"><span id="fig:distancewarning"></span>
            <img src="pics4b/11_dist_warning.png" alt="Warning for lack of projection with Euclidean distance"
              width="30%" />
            <p class="caption">
              Figure 30: Warning for lack of projection with Euclidean distance
            </p>
          </div>
        </div>
        <div id="great-circle-distance-1" class="section level4 unnumbered" number="">
          <h4>Great circle distance</h4>
          <p>Instead of using Euclidean distance, for decimal degrees the great circle distance or arc distance needs to
            be computed. So far, we have only considered Euclidean distance (the default), but the drop down list in the
            weights file creation interface also includes <strong>Arc Distance</strong> (in miles or in kilometers), as
            shown in Figure <a href="#fig:arcdistanceoption">31</a>.</p>
          <div class="figure" style="text-align: center"><span id="fig:arcdistanceoption"></span>
            <img src="pics4b/11_arcdistance.png" alt="Arc distance option" width="40%" />
            <p class="caption">
              Figure 31: Arc distance option
            </p>
          </div>
          <p>With the <strong>Arc Distance (mi)</strong> option checked, the threshold distance becomes about
            91 miles, as displayed in the dialog in Figure <a href="#fig:arccutoffdistance">32</a>.</p>
          <div class="figure" style="text-align: center"><span id="fig:arccutoffdistance"></span>
            <img src="pics4b/11_arc_bandwidth.png" alt="Arc distance cut-off distance" width="40%" />
            <p class="caption">
              Figure 32: Arc distance cut-off distance
            </p>
          </div>
          <p>Proceeding in the usual fashion (and saving the weights as <strong>natregimes_darc</strong>) adds the
            properties of the new weights to the list in the weights manager, shown in
            Figure <a href="#fig:arcweights">33</a>. Note how the properties include the
            distance unit (<strong>mile</strong>), the points for which the distances were
            computed (<strong>centroids</strong>), as well as the threshold value, with the distance metric now set to
            <strong>arc</strong>.</p>
          <div class="figure" style="text-align: center"><span id="fig:arcweights"></span>
            <img src="pics4b/11_natregimes_darc.png" alt="Arc distance weights properties" width="30%" />
            <p class="caption">
              Figure 33: Arc distance weights properties
            </p>
          </div>
        </div>
        <div id="distance-weight-properties-for-polygons" class="section level4 unnumbered" number="">
          <h4>Distance weight properties for polygons</h4>
          <p>The resulting weights clearly demonstrate the pitfalls of using a distance-band when polygons (such
            as U.S. counties) are of widely varying sizes. This is similar to the issues encountered for
            points with different densities. From the property list in Figure <a href="#fig:arcweights">33</a>, we see
            that the range of weights goes from 1 to 85. The connectivity
            histogram in Figure <a href="#fig:archist">34</a> illustrates the extensive range of neighbor cardinalities,
            very
            similar to what we obtained for the Cleveland data in Figure <a href="#fig:disthistogram">6</a>.</p>
          <div class="figure" style="text-align: center"><span id="fig:archist"></span>
            <img src="pics4b/3_843_archistogram.png" alt="Connectivity histogram for arc distance weights"
              width="40%" />
            <p class="caption">
              Figure 34: Connectivity histogram for arc distance weights
            </p>
          </div>
          <p>To illustrate the problem with the max-min cut-off distance, we search in the GWT file for the pair of
            observations that are a distance of 90.8652 apart. As shown in Figure <a href="#fig:elkodist">35</a>, the
            cut-off distance is
            between the centroids of FIPSNO 32007 (Elko county, NV) and FIPSNO 16083 (Twin Falls, ID).</p>
          <div class="figure" style="text-align: center"><span id="fig:elkodist"></span>
            <img src="pics4b/4_007_elkoingwt.png" alt="Max nearest neighbor distance for US counties" width="20%" />
            <p class="caption">
              Figure 35: Max nearest neighbor distance for US counties
            </p>
          </div>
          <p>Selecting the observation with FIPSNO 32007 in the Table (using the <strong>Selection Tool</strong>)
            highlights
            this location in all the open views. With the <strong>Connectivity Map</strong> open, we find that there
            is only one neighbor for the selected/highlighted Elko county, NV (FIPS code 32007).</p>
          <div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-1"></span>
            <img src="pics4b/11_elko.png" alt="Elko county connectivity map" width="60%" />
            <p class="caption">
              Figure 36: Elko county connectivity map
            </p>
          </div>
          <p>Clearly, the cut-off distance
            has major consequences for the smaller counties east of the Mississippi. As an illustration, we
            select the right-most bar in the connectivity histogram, the single location that has 85 neighbors.
            Checking the linked location in the table reveals that this selection refers to Jessamine county, KY, with
            FIPSNO 21113.<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a> We
            can now identify this county in the <strong>Connectivity Graph</strong>. As shown in Figure <a
              href="#fig:conngraph85">37</a>,
            we find that the roughly 91 mile range selects the 85 small counties that neighbor Jessamine county.</p>
          <div class="figure" style="text-align: center"><span id="fig:conngraph85"></span>
            <img src="pics4b/11_Jessamine.png" alt="Connectivity graph for Jessamine county, KY" width="60%" />
            <p class="caption">
              Figure 37: Connectivity graph for Jessamine county, KY
            </p>
          </div>
          <p>In practice, policy or theoretical considerations often dictate a given distance band (e.g., commuting
            distance). As we have seen, we need to be cautious before we uncritically translate these criteria into
            distance bands. Especially when the areal units in question are of widely varying sizes, there will be
            problems with the distribution of the neighbor cardinalities. In addition, isolates will result when the
            distance is insufficiently large.</p>
        </div>
      </div>
      <div id="general-distance-matrix" class="section level3 unnumbered" number="">
        <h3>General distance matrix</h3>
        <p>The <strong>Variables</strong> tab in the distance weights dialog also allows for the computation of a
          general distance
          matrix that is based on the distance between observations in multi-attribute space. As shown in Figure <a
            href="#fig:distvar">38</a>,
          a drop-down list with all the variables is available from which any number can be selected. In addition,
          the distance can be either Euclidean distance or Manhattan distance (absolute distances). Typically, the
          variables
          are first standardized, such that their mean is zero and variance one, which is the default setting.</p>
        <p>All the standard options are available, such as specifying a distance band (in multiattibute distance units)
          or
          k-nearest neighbors. Such general distance matrices are often used as an input in multivariate clustering
          methods.</p>
        <div class="figure" style="text-align: center"><span id="fig:distvar"></span>
          <img src="pics4b/11_variable_distance.png" alt="Distance computed from variables" width="40%" />
          <p class="caption">
            Figure 38: Distance computed from variables
          </p>
        </div>
      </div>
    </div>
    <div id="manipulating-weights-matrices" class="section level2 unnumbered" number="">
      <h2>Manipulating Weights Matrices</h2>
      <p>One final item that is available in the <strong>Weights Manager</strong> allows us to compute new weights by
        combining
        the information in two existing weights. Specifically, there is the <strong>Intersection</strong> and the
        <strong>Union</strong> between
        two spatial weights.</p>
      <p>In order to illustrate these functions, we continue with the <strong>natregimes</strong> example. However, we
        must first create (or load from an earlier project file) first and second order contiguity (non-inclusive), as
        well as knn weights using k= 6 (with arc distance). The <strong>Weights Manager</strong> should include at least
        the following weights: <strong>natregimes_q</strong>, <strong>natregimes_q2</strong>, and
        <strong>natregimes_k6</strong>.</p>
      <div id="intersection" class="section level3 unnumbered" number="">
        <h3>Intersection</h3>
        <p>We first specify <strong>natregimes_q</strong> and <strong>natregimes_k6</strong> as the weights and select
          the <strong>Intersection</strong> button, as in Figure <a href="#fig:intersection">39</a>.</p>
        <div class="figure" style="text-align: center"><span id="fig:intersection"></span>
          <img src="pics4b/11_intersection.png" alt="Spatial weights intersection" width="30%" />
          <p class="caption">
            Figure 39: Spatial weights intersection
          </p>
        </div>
        <p>This brings up the usual dialog to specify a file name for the new weights and populates the weights manager
          with
          the properties of the intersection between first order queen contiguity and k-6 nearest neighbors. We can
          easily check that the number of neighbors for queen contiguity varies between 1 and 14, with an average of
          5.89 neighbors and median of 6,
          whereas obviously the k-nearest weights all have 6 neighbors. The properties of the intersection are listed
          in Figure <a href="#fig:intersectionprop">40</a>. Since it is an intersection operation, the maximum number of
          weights cannot exceed 6, which is indeed the maximum. For those observations, the six nearest neighbor weights
          are also included among the contiguity weights. This is by no means always the case, as indicated by the
          decrease in the average number of neighbors to 5.15 and the median to 5.</p>
        <div class="figure" style="text-align: center"><span id="fig:intersectionprop"></span>
          <img src="pics4b/11_intersection_properties.png" alt="Properties of spatial weights intersection"
            width="30%" />
          <p class="caption">
            Figure 40: Properties of spatial weights intersection
          </p>
        </div>
      </div>
      <div id="union" class="section level3 unnumbered" number="">
        <h3>Union</h3>
        <p>We illustrate the second type of operation by means of the first and second order queen contiguity, where the
          latter
          is non-inclusive. A <strong>Union</strong> operation on those two weights should yield second order contiguity
          that are inclusive
          of first order neighbors.</p>
        <p>As evidenced by the results in Figure <a href="#fig:unionprop">41</a>, we indeed obtain the identical
          properties to what we
          had in the previous chapter. The average number of neighbors has increased to 18.44 and the density at 0.60%
          is higher than either first order contiguity (0.19%) or pure second order contiguity (0.41%).</p>
        <div class="figure" style="text-align: center"><span id="fig:unionprop"></span>
          <img src="pics4b/11_union_properties.png" alt="Properties of spatial weights union" width="30%" />
          <p class="caption">
            Figure 41: Properties of spatial weights union
          </p>
        </div>
      </div>
    </div>
    <div id="references" class="section level2 unnumbered" number="">
      <h2>References</h2>
      <div id="refs" class="references hanging-indent">
        <div id="ref-AnselinRey:14">
          <p>Anselin, Luc, and Sergio J. Rey. 2014. <em>Modern Spatial Econometrics in Practice, a Guide to Geoda,
              Geodaspace and Pysal</em>. Chicago, IL: GeoDa Press.</p>
        </div>
        <div id="ref-Yamada:16">
          <p>Yamada, Ikuho. 2016. “Thiessen Polygons.” <em>The International Encyclopedia of Geography</em>, 1–6.</p>
        </div>
      </div>
    </div>
    <div class="footnotes">
      <hr />
      <ol>
        <li id="fn1">
          <p>University of Chicago, Center for Spatial Data Science – <a href="mailto:anselin@uchicago.edu"
              class="email">anselin@uchicago.edu</a><a href="#fnref1" class="footnote-back">↩︎</a></p>
        </li>
        <li id="fn2">
          <p>The latitude
            is the <span class="math inline">\(y\)</span> dimension, and the longitude the <span
              class="math inline">\(x\)</span> dimension, so that
            the traditional reference to the pair (lat, lon) actually
            pertains to the coordinates as (y,x) and not (x,y).<a href="#fnref2" class="footnote-back">↩︎</a></p>
        </li>
        <li id="fn3">
          <p>The nearest neighbor distance
            is the smallest distance from a given point to all the other
            points, or, the distance from a point to its nearest neighbor.<a href="#fnref3" class="footnote-back">↩︎</a>
          </p>
        </li>
        <li id="fn4">
          <p>The selection tool with <strong>unique_id</strong> = 11359 will select the observation in
            the table. Through the process of linking, it will also be highlighted in the map.<a href="#fnref4"
              class="footnote-back">↩︎</a></p>
        </li>
        <li id="fn5">
          <p><span class="math inline">\(\mathbf{W&#39;}\)</span> is the <em>transpose</em>
            of the weights matrix <span class="math inline">\(\mathbf{W}\)</span>, such that rows of the original matrix
            become columns in the transpose.<a href="#fnref5" class="footnote-back">↩︎</a></p>
        </li>
        <li id="fn6">
          <p>For a more extensive technical discussion and historical background, see, e.g., <span
              class="citation">Yamada (<a href="#ref-Yamada:16" role="doc-biblioref">2016</a>)</span>.<a href="#fnref6"
              class="footnote-back">↩︎</a></p>
        </li>
        <li id="fn7">
          <p>The county is
            easily identified by using the <strong>Move Selected to Top</strong> option in the table.<a href="#fnref7"
              class="footnote-back">↩︎</a></p>
        </li>
      </ol>
    </div>


  </section>


  <!-- code folding -->


  <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>

</body>

</html>