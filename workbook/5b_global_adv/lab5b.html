<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Luc Anselin" />


<title>Global Spatial Autocorrelation (2)</title>

<link href="lab5b_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="lab5b_files/highlightjs-9.12.0/highlight.js"></script>
    <title>GeoDa on Github</title>

    <style>
    	*{margin:0;padding:0;}
	    .shadowfilter {
	       -webkit-filter: drop-shadow(12px 12px 7px rgba(0,0,0,0.5));
	        filter: url(shadow.svg#drop-shadow);
	     }
	     .intro1 { margin-left: -45px;}
    </style>
    <link rel="stylesheet" type="text/css" href="https://geodacenter.github.io/stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="https://geodacenter.github.io/stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="https://geodacenter.github.io/stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" href="https://geodacenter.github.io/stylesheets/simple-slideshow-styles.css">
    <style>
    ul {padding-left:30px;}
	figcaption {
	  top: .70em;
   	  left: .35em;
 	  bottom: auto!important;
	  right: auto!important;
	}
    </style>

        <style>
    h1 {
        text-align: center;
    }
    h3.subtitle {
        text-align: center;
    }
    h4.author {
        text-align: center;
    }
    h4.date {
        text-align: center;
    }
    p.caption {
        font-size : 12px;
    }
    </style>

<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-72724100-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->
<!-- Google Tag Manager -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-53RVF8"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-53RVF8');</script>
<!-- End Google Tag Manager -->

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





</head>

<body>


    <section class="page-header">
      <h1 class="project-name">GeoDa</h1>
      <h2 class="project-tagline">An Introduction to Spatial Data Analysis</h2>
      <a href="https://geodacenter.github.io/index.html" class="btn">Homepage</a>
      <a href="https://geodacenter.github.io/download.html" class="btn">Download</a>
      <a href="https://github.com/GeoDaCenter/geoda/" class="btn">View on GitHub</a>
      <a href="https://spatial.uchicago.edu/sample-data"  target="_blank" class="btn">Data</a>
       <a href="https://geodacenter.github.io/documentation.html" class="btn">Documentation</a>
       <a href="https://geodacenter.github.io/support.html" class="btn">Support</a>
       <a href="https://geodacenter.github.io/index-cn.html" class="btn">中文</a>
    </section>

    <section class="main-content">


<h1 class="title toc-ignore">Global Spatial Autocorrelation (2)</h1>
<h3 class="subtitle"><em>Bivariate, Differential and EB Rate Moran Scatter Plot</em></h3>
<h4 class="author"><em>Luc Anselin<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></em></h4>
<h4 class="date"><em>03/06/2019 (latest update)</em></h4>


<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#objectives">Objectives</a><ul>
<li><a href="#geoda-functions-covered">GeoDa functions covered</a></li>
</ul></li>
<li><a href="#getting-started">Getting Started</a></li>
</ul></li>
<li><a href="#bivariate-spatial-correlation---a-word-of-caution">Bivariate Spatial Correlation - A Word of Caution</a></li>
<li><a href="#bivariate-moran-scatter-plot">Bivariate Moran Scatter Plot</a><ul>
<li><a href="#concept">Concept</a></li>
<li><a href="#creating-a-bivariate-moran-scatter-plot">Creating a bivariate Moran scatter plot</a></li>
<li><a href="#a-closer-look-at-bivariate-spatial-correlation">A closer look at bivariate spatial correlation</a><ul>
<li><a href="#serial-temporal-correlation">Serial (temporal) correlation</a></li>
<li><a href="#serial-temporal-correlation-between-spatial-lags">Serial (temporal) correlation between spatial lags</a></li>
<li><a href="#space-time-regression">Space-time regression</a></li>
<li><a href="#serial-and-space-time-regression">Serial and space-time regression</a></li>
</ul></li>
</ul></li>
<li><a href="#differential-moran-scatter-plot">Differential Moran Scatter Plot</a><ul>
<li><a href="#concept-1">Concept</a></li>
<li><a href="#implementation">Implementation</a><ul>
<li><a href="#options">Options</a></li>
</ul></li>
</ul></li>
<li><a href="#moran-scatter-plot-for-eb-rates">Moran Scatter Plot for EB Rates</a><ul>
<li><a href="#concept-2">Concept</a></li>
<li><a href="#implementation-1">Implementation</a><ul>
<li><a href="#saving-the-results">Saving the results</a></li>
</ul></li>
</ul></li>
<li><a href="#references">References</a></li>
</ul>
</div>

<p><br></p>
<div id="introduction" class="section level2 unnumbered">
<h2>Introduction</h2>
<p>In this Chapter, we consider some extensions to the visualization of spatial autocorrelation
by means of the Moran scatter plot. Specifically, we extend the association between
a variable and its spatial lag to the context where the variable and the lag
pertain to two different variables, in the form of a
bivariate Moran scatter plot. We focus on this specifically in the context of relating a variable to
its neighbors in a different time period. We also consider a refinement of this concept that
applies the notion of a Moran scatter plot to the first difference (or any difference)
of time-enabled variables, as the differential Moran scatter plot. We close with an adjustment of Moran’s I designed to deal
with the variance instability of rates or proportions, the EBI Moran scatter plot.</p>
<p>We will again use the <strong>U.S. County Homicides</strong> sample data
set that comes pre-installed with GeoDa. It contains values for homicides and several socio-economic determinants for the 3085 counties in the continental United States.</p>
<div id="objectives" class="section level3 unnumbered">
<h3>Objectives</h3>
<ul>
<li><p>Visualize bivariate spatial correlation</p></li>
<li><p>Assess different aspects of bivariate spatial correlation</p></li>
<li><p>Visualize bivariate spatial correlation among time-differenced values</p></li>
<li><p>Correct Moran’s I for the variance instability in rates</p></li>
</ul>
<div id="geoda-functions-covered" class="section level4 unnumbered">
<h4>GeoDa functions covered</h4>
<ul>
<li>Space &gt; Bivariate Moran’s I
<ul>
<li>variable selection</li>
<li>permutation inference</li>
<li>saving the spatial lag</li>
<li>Moran scatter plot options</li>
</ul></li>
<li>Space &gt; Differential Moran’s I
<ul>
<li>saving the first differences and spatial lag</li>
</ul></li>
<li>Space &gt; Moran’s I with EB Rate
<ul>
<li>saving the rate</li>
</ul></li>
</ul>
<p><br></p>
</div>
</div>
<div id="getting-started" class="section level3 unnumbered">
<h3>Getting Started</h3>
<p>Before exploring the bivariate extensions, we turn a few of the variables
in the <strong>natregimes</strong> data set into time-enabled variables. Specifically, using the
techniques illustrated earlier, we <em>group</em> the homicide rates <strong>hr60</strong> through <strong>hr90</strong>
into <strong>hr</strong>, the homicide counts <strong>hc60</strong> to <strong>hc90</strong> into <strong>hc</strong>, and the population
counts <strong>po60</strong> through <strong>po90</strong> into <strong>po</strong>.</p>
<p>In addition to the grouped variables, we also need to create at least one spatial weights matrix,
e.g., <strong>natregimes_q</strong> for first order queen contiguity.</p>
<p>After saving all this information into a project file, we clear the current project and
load the new project file into the <strong>Connect to Data Sources</strong> dialog. This brings
up the familiar green themeless U.S. counties map.</p>
</div>
</div>
<div id="bivariate-spatial-correlation---a-word-of-caution" class="section level2 unnumbered">
<h2>Bivariate Spatial Correlation - A Word of Caution</h2>
<p>The concept of bivariate spatial correlation is complex and often misinterpreted.
It is typically considered to be the correlation between one variable and the spatial
lag of another variable, as originally implemented in the precursor of GeoDa
<span class="citation">(e.g., as described in Anselin, Syabri, and Smirnov <a href="#ref-Anselinetal:02b">2002</a>)</span>. However, this does not take into account
the inherent correlation between the two variables. More precisely, the bivariate
spatial correlation is between <span class="math inline">\(x_i\)</span> and <span class="math inline">\(\sum_j w_{ij} y_j\)</span>, but does not take into
account the correlation between <span class="math inline">\(x_i\)</span> and <span class="math inline">\(y_i\)</span>, i.e., between the two variables at
the same location.</p>
<p>As a result, this statistic is often interpreted incorrectly, as it may overestimate
the spatial aspect of the correlation that instead may be due mostly to the in-place correlation. <span class="citation">Lee (<a href="#ref-LeeS:01">2001</a>)</span> provides an alternative that considers a separation between the correlative aspect and the spatial aspect, but we will not pursue that here.</p>
<p>Below, we provide a more in-depth assessment of the different aspects of bivariate spatial
and non-spatial association, but first we turn to the original concept of a
bivariate Moran scatter plot.</p>
</div>
<div id="bivariate-moran-scatter-plot" class="section level2 unnumbered">
<h2>Bivariate Moran Scatter Plot</h2>
<div id="concept" class="section level3 unnumbered">
<h3>Concept</h3>
<p>In its initial conceptualization, as mentioned above, a bivariate Moran scatter plot
extends the idea of a Moran scatter plot with a variable on the x-axis and its spatial lag
on a y-axis to a bivariate context. The fundamental difference is that in the bivariate
case the spatial lag pertains to a different variable. In essence, this notion of
bivariate spatial correlation measures the degree to which the value for a given
variable at a location is correlated with its neighbors for a <em>different variable</em>.</p>
<p>As in the univariate Moran scatter plot, the interest is in the slope of the linear
fit. This yields a Moran’s I-like statistic as:
<span class="math display">\[I_B = \frac{\sum_i (\sum_j w_{ij} y_j \times x_i)}{ \sum_i x_i^2},\]</span>
or, the slope of a regression of <span class="math inline">\(Wy\)</span> on <span class="math inline">\(x\)</span>.</p>
<p>As before, all variables are expressed in standardized form, such that their means are zero and their variance one. In addition, the spatial weights are row-standardized.</p>
<p>Note that, unlike in the univariate autocorrelation case, the regression of <span class="math inline">\(x\)</span> on <span class="math inline">\(Wy\)</span> also yields
an unbiased estimate of the slope, providing an alternative
perspective on bivariate spatial correlation (see below for further discussion).<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<p>A special case of bivariate spatial autocorrelation is when the variable is measured at two points in
time, say <span class="math inline">\(z_{i,t}\)</span> and <span class="math inline">\(z_{i,t-1}\)</span>. The statistic then pertains to the extent to which the value
observed at a location at a given time, is correlated with its value at neighboring locations
at a different point in time.</p>
<p>The natural interpretation of this concept is to relate <span class="math inline">\(z_{i,t}\)</span> to
<span class="math inline">\(\sum_j w_{ij} z_{j,t-1}\)</span>, i.e., the correlation between a value at <span class="math inline">\(t\)</span> and its neighbors in
a previous time period:
<span class="math display">\[I_T = \frac{\sum_i (\sum_j w_{ij} z_{j,t-1} \times z_{i,t})}{ \sum_i z_{i,t}^2},\]</span>
i.e., the effect of neighbors in <span class="math inline">\(t-1\)</span> on the present value.</p>
<p>Alternatively, and maybe less intuitively, one can relate the value at a previous time
period <span class="math inline">\(z_{t-1}\)</span> to its neighbors in the future, <span class="math inline">\(\sum_j w_{ij} z_t\)</span>, as:
<span class="math display">\[I_T = \frac{\sum_i (\sum_j w_{ij} z_{j,t} \times z_{i,t-1})}{ \sum_i z_{i,t-1}^2},\]</span>
i.e., the effect of a location at <span class="math inline">\(t-1\)</span> on its neighbors in the future.</p>
<p>While formally correct,
this may not be a proper interpretation of the dynamics involved. In fact, the notion
of spatial correlation pertains to the effect of neighbors on a central location, not
the other way around. While the Moran scatter plot seems to reverse this logic, this
is purely a formalism, without any consequences in the univariate case. However, when
relating the slope in the scatter plot to the dynamics of a process, this should
be interpreted with caution.</p>
<p>A possible source of confusion is that the proper <em>regression</em> specification for a
dynamic process would be as:
<span class="math display">\[z_{i,t} = \beta_1 \sum_j w_{ij} z_{j,t-1} + u_i,\]</span>
with <span class="math inline">\(u_i\)</span> as the usual error term, and <em>not</em> as:
<span class="math display">\[z_{i,t-1} = \beta_2 \sum_j w_{ij} z_{j,t} + u_i,\]</span>
which would have the future <em>predicting the past</em>. This contrasts with the linear
regression specification
used (purely formally) to estimate the bivariate Moran’s I, for example:
<span class="math display">\[\sum_j w_{ij} z_{j,t-1} = \beta_3 z_{i,t} + u_i.\]</span></p>
<p>In terms of the interpretation of a dynamic process, only <span class="math inline">\(\beta_1\)</span> has intuitive appeal. However,
in terms of measuring the degree of <em>spatial</em> correlation between past neighbors and a current value,
as measured by a Moran’s I coefficient, <span class="math inline">\(\beta_3\)</span> is the correct interpretation.</p>
<p>As
mentioned earlier, a fundamental difference with the univariate case is that the spatially lagged
variable is no longer endogenous, so both specifications can be estimated by means of ordinary
least squares.</p>
<p>In the univariate case, only the specification with the spatially lagged variable
on the left hand side yields a valid estimate. As a result, for the univariate Moran’s I, there is no ambiguity about which variables should be on the x-axis and y-axis.</p>
<p>Inference is again based on a permutation approach, but with an important difference.
Since the interest focuses on the bivariate spatial association, the values for <span class="math inline">\(x\)</span> are fixed
at their locations, and only the values for <span class="math inline">\(y\)</span> are randomly permuted. In the usual manner,
this yields a reference distribution for the statistic under the null hypothesis that the
spatial arrangement of the <span class="math inline">\(y\)</span> values is random. As mentioned, it is important to keep
in mind that since the focus is on the
correlation between the <span class="math inline">\(x\)</span> value at <span class="math inline">\(i\)</span> and the <span class="math inline">\(y\)</span> values at the neighboring locations,
the correlation between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> at location <span class="math inline">\(i\)</span> is ignored.</p>
</div>
<div id="creating-a-bivariate-moran-scatter-plot" class="section level3 unnumbered">
<h3>Creating a bivariate Moran scatter plot</h3>
<p>The <strong>Bivariate Moran’s I</strong> is invoked from the menu or from the drop-down list provided by
selecting the <strong>Moran Scatter Plot</strong> icon on the toolbar, shown in Figure <a href="#fig:bivmorscaticon">1</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:bivmorscaticon"></span>
<img src="pics5b/1_521_bivariate_icon.png" alt="Bivariate Moran scatter plot icon" width="25%" />
<p class="caption">
Figure 1: Bivariate Moran scatter plot icon
</p>
</div>
<p>The next dialog brings up the variable specification. In our example, we will illustrate the
most useful way to employ bivariate spatial correlation, i.e., its application to assess the
correlation between a variable and its neighbors at a different time period. Ignoring
the in-situ temporal correlation, such a measure gives insight into the extent to which
neighboring locations in a previous time period are correlated with the value at a
location at a future time period. In other words, this gives some indication of
space-time correlation (but also see below for a more refined analysis).</p>
<p>To illustrate this functionality, we select as the x-axis variable, the homicide rate
in 1990 – <strong>hr (90)</strong> –, and as the y-axis its value in 1980 – <strong>hr (80)</strong> –, which will be the spatial
lag. The dialog is the familiar one for time-enabled variables, with the <strong>Time</strong> drop
down list allowing variables to be selected for different time periods, and the
spatial weights specified in the <strong>Weights</strong> list. In our example, shown in
Figure <a href="#fig:bivmorscatvars">2</a>, the spatial
weights are the queen contiguity weights, <strong>natregimes_q</strong>.</p>
<div class="figure" style="text-align: center"><span id="fig:bivmorscatvars"></span>
<img src="pics5b/1_522_biv_variables.png" alt="Bivariate Moran scatter variable selection" width="50%" />
<p class="caption">
Figure 2: Bivariate Moran scatter variable selection
</p>
</div>
<p>The bivariate Moran scatter plot shows a scatter plot with <strong>spatial lag of hr (80)</strong>
(<span class="math inline">\(Wy\)</span>) on the y-axis and <strong>hr (90)</strong> (<span class="math inline">\(x\)</span>) on the x-axis. The slope of the linear
fit is the bivariate Moran’s I (as defined above). In our example, this is about 0.360,
as illustrated in Figure <a href="#fig:bivmorscat">3</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:bivmorscat"></span>
<img src="pics5b/1_523_bivariate_morscat.png" alt="Bivariate Moran scatter plot" width="80%" />
<p class="caption">
Figure 3: Bivariate Moran scatter plot
</p>
</div>
<p>All the same options as for the univariate Moran scatter plot apply here as well. For example,
a permutation inference would indicated a high significance of the association, with a
pseudo p-value of 0.001 (for 999 permutations).<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> Also, the standardized value of the x variable and the spatial
lag of the y-variable (applied to its standardized value) can be saved to the table, in
the same way as for the univariate Moran scatter plot.</p>
</div>
<div id="a-closer-look-at-bivariate-spatial-correlation" class="section level3 unnumbered">
<h3>A closer look at bivariate spatial correlation</h3>
<p>In contrast to the univariate Moran scatter plot, where the interpretation of the
linear fit is unequivocably Moran’s I, there is no such clarity in the bivariate case.
In addition to the interpretation offered above, which is a <em>traditional</em> Moran’s I-like
coefficient, there are at least four additional perspectives that are relevant. We
consider each in turn.</p>
<div id="serial-temporal-correlation" class="section level4 unnumbered">
<h4>Serial (temporal) correlation</h4>
<p>First, we need to consider the bivariate correlation between the homicide rate
in the two time periods, i.e.,
<strong>hr (90)</strong> and <strong>hr (80)</strong>. To implement this, we create four new variables. First,
we standardize the homicide rates for each of the years, say as <strong>hr80st</strong> and <strong>hr90st</strong>.
Next, we compute the spatial lags for these variables using the queen contiguity
weights, say <strong>whr80st</strong> and
<strong>whr90st</strong>.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></p>
<p>The relation between <strong>hr90st</strong> and <strong>hr80st</strong> (or, in general, between a variable
<span class="math inline">\(y_{i,t}\)</span> and its time lag <span class="math inline">\(y_{i,t-1}\)</span>) yields a highly significant slope of <strong>0.553</strong>,
as shown in the standard scatter plot graph in Figure <a href="#fig:scathr9080">4</a>. This suggests a very strong temporal correlation
of this variable over time.</p>
<div class="figure" style="text-align: center"><span id="fig:scathr9080"></span>
<img src="pics5b/4_535_scat_hr90_hr80.png" alt="Scatter plot hr90 on hr80" width="80%" />
<p class="caption">
Figure 4: Scatter plot hr90 on hr80
</p>
</div>
</div>
<div id="serial-temporal-correlation-between-spatial-lags" class="section level4 unnumbered">
<h4>Serial (temporal) correlation between spatial lags</h4>
<p>Closely related to this temporal correlation is the linear relation between the spatial lag of the crime
rates between the two time periods (i.e., a regression of the variable <span class="math inline">\(\sum_j w_{ij} y_{j,t}\)</span>
on <span class="math inline">\(\sum_j w_{ij} y_{j,t-1}\)</span>). In some sense, if there is a strong temporal correlation
between the variable <em>in-situ</em>, then it is likely that there is also a strong temporal
correlation between their neighbors (in the form of their spatial lags). Again, the
standard scatter plot yields a strongly significant positive slope of <strong>0.801</strong>, even
higher than for the variable in-situ, as listed in Figure <a href="#fig:scatwhr9080">5</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:scatwhr9080"></span>
<img src="pics5b/4_537_scatwr90_wr80.png" alt="Scatter plot W_hr90 on W_hr80" width="80%" />
<p class="caption">
Figure 5: Scatter plot W_hr90 on W_hr80
</p>
</div>
</div>
<div id="space-time-regression" class="section level4 unnumbered">
<h4>Space-time regression</h4>
<p>Thirdly, as mentioned earlier, there is no issue with regressing the value of <strong>hr90st</strong>
on the spatial lag in 1980 (<strong>whr80st</strong>). Unlike what is the case in the pure cross-sectional
situation, where the spatial lag is endogenous, the spatial lag in a <em>different</em> time period is exogenous (in the absence of temporal correlation).</p>
<p>The implication
of this is that the ordinary regression estimate of the slope coefficient of <strong>hr90st</strong>
on <strong>whr80st</strong> is unbiased. In the standard spatial scatter plot, this yields
a slope of <strong>0.746</strong>, again highly significant, as shown in Figure <a href="#fig:scatw80h90">6</a>.</p>
<p>The specification with the value of
a variable at time <span class="math inline">\(t\)</span> regressed on the value of its neighbors at time <span class="math inline">\(t - 1\)</span>
(formally, a regression of <span class="math inline">\(y_{i,t}\)</span> on <span class="math inline">\(\sum_j w_{ij} y_{j,t-1}\)</span>) is the
most natural formulation of a <em>space-time regression</em>, expressing how the values at
neighboring locations at the previous time period <em>diffuse</em> to the location at the
next time period.</p>
<div class="figure" style="text-align: center"><span id="fig:scatw80h90"></span>
<img src="pics5b/4_536_scathr90_whr80.png" alt="Scatter plot hr90 on W_hr80" width="80%" />
<p class="caption">
Figure 6: Scatter plot hr90 on W_hr80
</p>
</div>
</div>
<div id="serial-and-space-time-regression" class="section level4 unnumbered">
<h4>Serial and space-time regression</h4>
<p>Finally, we can include both in-situ correlation and space-time correlation in a
regression specification of <span class="math inline">\(y_{i,t}\)</span> (i.e., <strong>hr90st</strong>) on both <span class="math inline">\(x_{i,t-1}\)</span> (i.e., <strong>hr80st</strong>) and
<span class="math inline">\(\sum_j w_{ij}x_{j,t-1}\)</span> (i.e., <strong>whr80st</strong>). In the absence of temporal error autocorrelation,
standard ordinary least squares regression will yield unbiased estimates of the coefficients.</p>
<p>Using the regression functionality of GeoDa (not further considered here), this yields
the result shown in Figure <a href="#fig:fullregression">7</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:fullregression"></span>
<img src="pics5b/4_534_bivariate_regression.png" alt="Bivariate lag decomposition regression" width="80%" />
<p class="caption">
Figure 7: Bivariate lag decomposition regression
</p>
</div>
<p>Correcting for both the in-situ correlation and the space-time correlation simultaneously considerably lowers the regression coefficients. In the regression, both effects are
highly significant, with a coefficient of <strong>0.384</strong> for the in-situ effect, and
<strong>0.442</strong> for the space-time effect.</p>
<p>Needless to say, focusing the analysis solely on the bivariate Moran scatter plot provides only
a limited perspective on the complexity of space-time (or, in general, bivariate) spatial
and space-time associations.</p>
</div>
</div>
</div>
<div id="differential-moran-scatter-plot" class="section level2 unnumbered">
<h2>Differential Moran Scatter Plot</h2>
<div id="concept-1" class="section level3 unnumbered">
<h3>Concept</h3>
<p>An alternative to the bivariate spatial correlation between a variable at one point
in time and its neighbors at a previous (or, in general, any different) point in time is to control for the locational
<em>fixed effects</em> by diffencing the variable. More precisely, we apply the
computation of the spatial autocorrelation statistic to the variable <span class="math inline">\(y_{i,t} - y_{i,t-1}\)</span>.</p>
<p>This takes care of any temporal correlation that may be the result of a fixed effect
(i.e. a set of variables determining the value of <span class="math inline">\(y_i\)</span> that remain unchanged over time).
Specifically, if <span class="math inline">\(\mu_i\)</span> were a fixed effect associated with location <span class="math inline">\(i\)</span>, we could
express the value at each location for time <span class="math inline">\(t\)</span> as the sum of some intrinsic value and the fixed effect,
as <span class="math inline">\(y_{i,t} = y*_{i,t} + \mu_i\)</span>, where <span class="math inline">\(\mu_i\)</span> is unchanged over time (hence, fixed).
The presence of <span class="math inline">\(\mu_i\)</span> induces a <em>temporal</em> correlation between <span class="math inline">\(y_{i,t}\)</span> and
<span class="math inline">\(y_{i,t-1}\)</span>, above and beyond the correlation between <span class="math inline">\(y*_{i,t}\)</span> and <span class="math inline">\(y*_{i,t-1}\)</span>.
Taking the first difference eliminates the fixed effect and ensures that any remaining
correlation is solely due to <span class="math inline">\(y*\)</span>.</p>
<p>A differential Moran’s I is then the slope in
a regression of
the spatial lag of the difference, i.e., <span class="math inline">\(\sum_j w_{ij} (y_{j,t} - y_{j,t-1})\)</span> on
the difference <span class="math inline">\((y_{i,t} - y_{i,t-1})\)</span>. Note that in GeoDa, the slope computation is applied
to the standardized value of the difference (i.e., the
standardization of <span class="math inline">\(y_{i,t} - y_{i,t-1}\)</span>), and not to the difference between the standardized values.</p>
<p>All the caveats and different interpretations
that apply to the generic bivariate case are also relevant here.</p>
</div>
<div id="implementation" class="section level3 unnumbered">
<h3>Implementation</h3>
<p>We start the differential Moran scatter plot in the by now familiar way, from the
main menu as <strong>Space &gt; Differential Moran’s I</strong>, or from the Moran scatter plot toolbar
icon, as the third item in the drop down list, shown in Figure <a href="#fig:diffmoran">8</a>.</p>
<p>Note that this functionality is only
available for data sets with <em>grouped</em> variables. If there are no grouped variables
present, a warning message will be generated.</p>
<div class="figure" style="text-align: center"><span id="fig:diffmoran"></span>
<img src="pics5b/2_525_differential_icon.png" alt="Differential Moran scatter plot icon" width="25%" />
<p class="caption">
Figure 8: Differential Moran scatter plot icon
</p>
</div>
<p>With grouped variables in the data set, selecting the option brings up the variable selection dialog. This contains four drop down lists, as illustrated in Figure <a href="#fig:diffmoranvars">9</a>.</p>
<p>The <strong>Select variable</strong> list contains only the
<em>grouped</em> variables. In our example, this is <strong>hr</strong>, <strong>hc</strong> and <strong>po</strong>, as shown. The next
two drop down lists allow the time periods to be chosen (these correspond to the time
labels entered when creating the grouped variables). Finally, the list at the bottom
allows for the selection of the spatial weights. In our example, we take <strong>hr</strong> between
<strong>90</strong> and <strong>80</strong> with the <strong>natregimes_q</strong> spatial weights.</p>
<div class="figure" style="text-align: center"><span id="fig:diffmoranvars"></span>
<img src="pics5b/2_526_differential_var_setting.png" alt="Differential Moran variable selection" width="60%" />
<p class="caption">
Figure 9: Differential Moran variable selection
</p>
</div>
<p>The result is the familiar plot, shown in Figure <a href="#fig:diffmorscat">10</a>. The slope is about 0.052, much smaller in magnitude
than the bivariate space-time measures obtained so far. Of course, the same plot could have
been obtained from the standard univariate Moran scatter plot, after first creating the
first differences in the table calculator.</p>
<p>Even with this small
value for Moran’s I, the statistic is highly significant. Permutation inference (not shown)
with 999 replications yields a pseudo p-value of 0.001 and corresponding z-value
of 5.03.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<div class="figure" style="text-align: center"><span id="fig:diffmorscat"></span>
<img src="pics5b/2_527_differential_morscat.png" alt="Differential Moran scatter plot" width="80%" />
<p class="caption">
Figure 10: Differential Moran scatter plot
</p>
</div>
<div id="options" class="section level4 unnumbered">
<h4>Options</h4>
<p>All the standard Moran scatter plot options also apply to the differential plot.</p>
<p>For example,
after activating the <strong>View &gt; Regimes Regression</strong> option, we can investigate the
difference between regionalized autocorrelation coefficients. In the same manner as we
implemented for the standard Moran scatter plot, we can select a subset of observations,
such as the counties in the south, and assess the effect on the autocorrelation coefficient.</p>
<p>In Figure <a href="#fig:difmorregimes">11</a>, the Moran scatter plot on the left shows the value for the
1321 selected observations as 0.0658,
with the value for the complement (unselected) as 0.0314, compared to the overall coefficient of 0.052.
As before, this is purely illustrative and is not associated with a formal test for
structural stability.</p>
<div class="figure" style="text-align: center"><span id="fig:difmorregimes"></span>
<img src="pics5b/2_540_differentialregimes.png" alt="Brushing the differential Moran scatter plot" width="100%" />
<p class="caption">
Figure 11: Brushing the differential Moran scatter plot
</p>
</div>
<p>Finally, the option to <strong>Save Results</strong> works in a slightly different fashion from the standard
case. In addition to the standardized value (of <span class="math inline">\(y_{i,t} - y_{i,t-1}\)</span>) and its spatial
lag, the actual first difference (in unstandardized form) can be saved to the table
as well, when the <strong>Diff Values</strong> box is checked, as in Figure <a href="#fig:difmorsave">12</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:difmorsave"></span>
<img src="pics5b/2_541_save_results.png" alt="Saving the first difference and its spatial lag" width="35%" />
<p class="caption">
Figure 12: Saving the first difference and its spatial lag
</p>
</div>
</div>
</div>
</div>
<div id="moran-scatter-plot-for-eb-rates" class="section level2 unnumbered">
<h2>Moran Scatter Plot for EB Rates</h2>
<div id="concept-2" class="section level3 unnumbered">
<h3>Concept</h3>
<p>An Empirical Bayes (EB) standardization was suggested by
<span class="citation">Assunção and Reis (<a href="#ref-AssuncaoReis:99">1999</a>)</span> as a means to correct Moran’s I spatial
autocorrelation test statistic
for varying population densities
across observational units, when the variable of interest is a rate or
proportion. This standardization borrows ideas from the Bayesian
<em>shrinkage</em> estimator outlined in discussion of
Empirical Bayes smoothing.</p>
<p>This approach is different from EB smoothing
in that
the spatial autocorrelation is not computed for
a smoothed version of the original rate, but for a <em>transformed standardized</em> random variable.
In other words, the
crude rate is turned into a new variable that has a mean of zero and unit variance,
thus avoiding problems with variance instability. The mean and variance
used in the transformation are computed for each individual observation,
thereby properly accounting for the instability in variance.</p>
<p>The technical aspects are given in detail in <span class="citation">Assunção and Reis (<a href="#ref-AssuncaoReis:99">1999</a>)</span>
and in the review by <span class="citation">Anselin, Lozano-Gracia, and Koschinky (<a href="#ref-Anselinetal:06c">2006</a>)</span>, but we briefly touch upon some salient
issues here. The point of departure is the crude rate, say <span class="math inline">\(r_i = O_i / P_i\)</span>,
where <span class="math inline">\(O_i\)</span> is the count of events at location <span class="math inline">\(i\)</span> and <span class="math inline">\(P_i\)</span> is the corresponding
population at risk.</p>
<p>The rationale behind the Assuncao-Reis approach is to
standardize each <span class="math inline">\(r_i\)</span> as
<span class="math display">\[z_i = \frac{r_i - \beta}{\sqrt{\alpha + (\beta / P_i)}},\]</span>
using an estimated mean <span class="math inline">\(\beta\)</span> and standard error <span class="math inline">\(\sqrt{\alpha + \beta / P_i}\)</span>.
The parameters <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are related to the prior distribution for the
risk, which we detailed in the Chapter on rate mapping.</p>
<p>In practice, the prior parameters are estimated by means of the so-called method of moments
<span class="citation">(e.g., Marshall <a href="#ref-Marshall:91">1991</a>)</span>, yielding the following expressions:
<span class="math display">\[\beta = O / P,\]</span>
with <span class="math inline">\(O\)</span> as the total event count (<span class="math inline">\(\sum_i O_i\)</span>), and <span class="math inline">\(P\)</span> as the total population count
(<span class="math inline">\(\sum_i P_i\)</span>), and
<span class="math display">\[\alpha = [\sum_i P_i ( r_i - \beta )^2 ] / P - \beta / ( P / n),\]</span>
with <span class="math inline">\(n\)</span> as the total number of observations (in other words, <span class="math inline">\(P/n\)</span> is the average
population).</p>
<p>One problem with the method of moments estimator
is that the expression for <span class="math inline">\(\alpha\)</span> could yield a
negative result. In that case, its value is typically set to zero, i.e.,
<span class="math inline">\(\alpha=0\)</span>.
However, in <span class="citation">Assunção and Reis (<a href="#ref-AssuncaoReis:99">1999</a>)</span>, the value for <span class="math inline">\(\alpha\)</span> is only set to zero
when the resulting estimate for the variance is negative,
that is, when <span class="math inline">\(\alpha + \beta / P_i &lt; 0\)</span>. Slight differences in the
standardized variates may result depending on the convention used. In GeoDa,
when the variance estimate is negative, the original raw rate is used.</p>
</div>
<div id="implementation-1" class="section level3 unnumbered">
<h3>Implementation</h3>
<p>The Moran scatter plot for standardized rates is invoked from the main menu as
<strong>Space &gt; Moran’s I with EB Rate</strong>, or as the fourth item on the Moran scatter
plot toolbar icon, as in Figure <a href="#fig:ebmorscaticon">13</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:ebmorscaticon"></span>
<img src="pics5b/3_529_EB_icon.png" alt="EBI Moran scatter plot icon" width="25%" />
<p class="caption">
Figure 13: EBI Moran scatter plot icon
</p>
</div>
<p>The variable selection dialog follows the same logic as for all rate calculations,
with a selection of the <strong>Event Variable</strong> (the numerator) and the <strong>Base Variable</strong>
(the denominator).</p>
<p>In our example, with time-enabled variables, we can also pick the relevant <strong>Time</strong>
periods, as shown in Figure <a href="#fig:ebmorscatvars">14</a>. At the bottom of the dialog is the selection of the spatial weights.
In our example, we choose the homicide count in 1960, <strong>hc(60)</strong>, as the numerator,
and the population, <strong>po(60)</strong>, as the denominator, with <strong>natregimes_q</strong> as the
weights.</p>
<div class="figure" style="text-align: center"><span id="fig:ebmorscatvars"></span>
<img src="pics5b/3_530_eb_variables.png" alt="EBI Moran scatter plot variable selection" width="50%" />
<p class="caption">
Figure 14: EBI Moran scatter plot variable selection
</p>
</div>
<p>This yields the Moran scatter plot shown in Figure <a href="#fig:ebmorscat">15</a>. The axes labels show the numerator and denominator of
the rates for which the statistic was computed. In our example, the result is a spatial
autocorrelation coefficient of 0.518. Using permutation inference (not shown) with
999 permutations yields a pseudo p-value of 0.001 with an associated z-value of 48.7.
All standard options for the Moran scatter plot apply (and will not be reviewed).</p>
<div class="figure" style="text-align: center"><span id="fig:ebmorscat"></span>
<img src="pics5b/3_531_ebmorscat.png" alt="EBI Moran scatter plot" width="80%" />
<p class="caption">
Figure 15: EBI Moran scatter plot
</p>
</div>
<p>For comparison purposes, we also compute Moran’s I for the crude rate, <strong>hr(60)</strong>
(using the same queen contiguity spatial weights). The
result, shown in Figure <a href="#fig:morscatrawrate">16</a> yields a spatial autocorrelation coefficient of 0.369, quite a bit lower in
absolute magnitude. This coefficient remains highly significant at 0.001
with a z-value of 33.7.</p>
<div class="figure" style="text-align: center"><span id="fig:morscatrawrate"></span>
<img src="pics5b/3_533_rawrate.png" alt="Moran scatter plot for the raw rate" width="80%" />
<p class="caption">
Figure 16: Moran scatter plot for the raw rate
</p>
</div>
<p>Note that the inference for the raw rate may be somewhat misleading since it
ignores the intrinsic variance instability of the rates. In a strict sense, the Moran’s I
test for spatial autocorrelation is based on an assumption of a constant mean (obtained by
de-meaning the variables) <em>and</em> a constant variance. The latter is violated in the case
of rates. The EBI transformation ensures that this does not affect the resulting inference.</p>
<div id="saving-the-results" class="section level4 unnumbered">
<h4>Saving the results</h4>
<p>A slight difference with the options for the standard Moran scatter plot pertains to the <strong>Save Results</strong> item. An additional option allows for the transformed rates to be added to the data table. The values are the actual EBI rates, not their standardized form that is used in the computation of Moran’s I. The results are identical to what would be obtained using the <strong>Rates</strong> option in the <strong>Table Calculator</strong>. The option is given as <strong>EB Rates</strong> in Figure <a href="#fig:ebsaveresults">17</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:ebsaveresults"></span>
<img src="pics5b/3_EB_saveresults.png" alt="Save EB rates" width="35%" />
<p class="caption">
Figure 17: Save EB rates
</p>
</div>
<p><br></p>
</div>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>
<div id="refs" class="references">
<div id="ref-Anselinetal:06c">
<p>Anselin, Luc, Nancy Lozano-Gracia, and Julia Koschinky. 2006. “Rate Transformations and Smoothing.” Technical Report. Urbana, IL: Spatial Analysis Laboratory, Department of Geography, University of Illinois.</p>
</div>
<div id="ref-Anselinetal:02b">
<p>Anselin, Luc, Ibnu Syabri, and Oleg Smirnov. 2002. “Visualizing Multivariate Spatial Correlation with Dynamically Linked Windows.” In <em>New Tools for Spatial Data Analysis: Proceedings of the Specialist Meeting</em>, edited by Luc Anselin and Sergio Rey. University of California, Santa Barbara: Center for Spatially Integrated Social Science (CSISS).</p>
</div>
<div id="ref-AssuncaoReis:99">
<p>Assunção, Renato, and Edna A. Reis. 1999. “A New Proposal to Adjust Moran’s I for Population Density.” <em>Statistics in Medicine</em> 18: 2147–61.</p>
</div>
<div id="ref-LeeS:01">
<p>Lee, Sang-Il. 2001. “Developing a Bivariate Spatial Association Measure: An Integration of Pearson’s r and Moran’s I.” <em>Journal of Geographical Systems</em> 3: 369–85.</p>
</div>
<div id="ref-Marshall:91">
<p>Marshall, R. J. 1991. “Mapping Disease and Mortality Rates Using Empirical Bayes Estimators.” <em>Applied Statistics</em> 40: 283–94.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>University of Chicago, Center for Spatial Data Science – <a href="mailto:anselin@uchicago.edu" class="email">anselin@uchicago.edu</a><a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>In the case of the regression of <span class="math inline">\(x\)</span> on <span class="math inline">\(Wx\)</span>, the
explanatory variable <span class="math inline">\(Wx\)</span> is <em>endogenous</em>, so that the ordinary least squares estimation
of the linear fit is <em>biased</em>. However, with <span class="math inline">\(Wy\)</span> referring to a different variable,
the so-called simultaneous equation bias is a non-issue.<a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>Using the default random seed, this
yields a z-value of 41.4.<a href="#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p>The specific steps have been illustrated extensively in previous Chapters.<a href="#fnref4" class="footnote-back">↩</a></p></li>
<li id="fn5"><p>In practice, once the data set contains over 1,000 observations, even very
small spatial correlation coefficients tend to turn out to be significant. This is
a consequence of the variance becoming smaller with larger sample sizes. It is an
issue comparable to the situation in a regression with a large number of observations when all coefficients
will tend to be <em>significant</em>.<a href="#fnref5" class="footnote-back">↩</a></p></li>
</ol>
</div>

<footer class="site-footer">
  <span class="site-footer-owner"><a href="https://github.com/lixun910/geoda">GeoDa</a> is maintained by <a href="#">lixun910</a>.</span>
  <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
</footer>

</section>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
